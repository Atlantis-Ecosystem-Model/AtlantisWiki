<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Atlantis Documentation – 2. INSTALLATION AND RUNNING</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Atlantis Documentation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-user-guides" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">User Guides</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-user-guides">    
        <li>
    <a class="dropdown-item" href="../../../user_guides/quarto_site/part1/index.html">
 <span class="dropdown-text">Part I - Atlantis User Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../user_guides/quarto_site/part2/index.html">
 <span class="dropdown-text">Part II - [Coming Soon]</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../confluence/index.html"> 
<span class="menu-text">Confluence Wiki</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../resources/index.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../user_guides/quarto_site/part1/03-installation-and-running.html">2. Installation and Running</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/01-foreward.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">0. Foreword</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/02-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/03-installation-and-running.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">2. Installation and Running</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/04-geometry-of-the-model-domain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Geometry of the Model Domain</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/05-hydrodynamic-salinity-and-temperature-forcing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Hydrodynamic, Salinity and Temperature Forcing Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/06-the-physics-submodel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. The Physics Submodel</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/07-definitions-of-functional-groups.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Definitions of Functional Groups</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/08-run-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Run Parameters</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/09-force-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Force Parameters</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/10-primary-producer-processes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Primary Producer Processes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/11-consumer-processes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Consumer Processes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/12-distribution-and-movement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Distribution and Movement</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/13-processes-in-bacterial-and-inanimate-pools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Processes in Bacterial and Inanimate Pools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/14-influence-of-environmental-factors-on-ecological-p.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Influence of Environmental Factors on Ecological Processes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/15-final-overview-of-ecology-routines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Final Overview of Ecology Routines</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/16-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/17-appendix-1-tips-for-calibrating-biological-model-n.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix 1: Tips for Calibrating Biological Model</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#how-to-check-out-and-install-the-code" id="toc-how-to-check-out-and-install-the-code" class="nav-link active" data-scroll-target="#how-to-check-out-and-install-the-code"><strong>2.1 How to check out and install the code</strong></a></li>
  <li><a href="#input-files" id="toc-input-files" class="nav-link" data-scroll-target="#input-files"><strong>2.2. Input files</strong></a></li>
  <li><a href="#overview-of-atlantis-submodels-and-the-main-routine" id="toc-overview-of-atlantis-submodels-and-the-main-routine" class="nav-link" data-scroll-target="#overview-of-atlantis-submodels-and-the-main-routine"><strong>2.3. Overview of Atlantis submodels and the main() routine</strong></a></li>
  <li><a href="#delving-into-the-code-finding-the-files-and-routines-that-describe-the-processes-you-are-interested-in" id="toc-delving-into-the-code-finding-the-files-and-routines-that-describe-the-processes-you-are-interested-in" class="nav-link" data-scroll-target="#delving-into-the-code-finding-the-files-and-routines-that-describe-the-processes-you-are-interested-in"><strong>2.4. Delving into the code: finding the files and routines that describe the processes you are interested in</strong></a></li>
  <li><a href="#how-to-setup-and-start-simulations" id="toc-how-to-setup-and-start-simulations" class="nav-link" data-scroll-target="#how-to-setup-and-start-simulations"><strong>2.5. How to setup and start simulations</strong></a>
  <ul>
  <li><a href="#crash-introduction-into-command-line-interfaces" id="toc-crash-introduction-into-command-line-interfaces" class="nav-link" data-scroll-target="#crash-introduction-into-command-line-interfaces"><em>2.5.1. Crash introduction into Command line interfaces</em></a></li>
  <li><a href="#setting-up-the-bat-file" id="toc-setting-up-the-bat-file" class="nav-link" data-scroll-target="#setting-up-the-bat-file"><em>2.5.2. Setting up the BAT file</em></a></li>
  <li><a href="#parameter-files-called-in-the-bat-command-line" id="toc-parameter-files-called-in-the-bat-command-line" class="nav-link" data-scroll-target="#parameter-files-called-in-the-bat-command-line"><em>2.5.3. Parameter files called in the BAT command line</em></a></li>
  <li><a href="#setting-up-batch-simulations" id="toc-setting-up-batch-simulations" class="nav-link" data-scroll-target="#setting-up-batch-simulations"><em>2.5.4. Setting up batch simulations</em></a></li>
  <li><a href="#initialising-simulations" id="toc-initialising-simulations" class="nav-link" data-scroll-target="#initialising-simulations"><em>2.5.5. Initialising simulations</em></a></li>
  </ul></li>
  <li><a href="#simulation-outputs" id="toc-simulation-outputs" class="nav-link" data-scroll-target="#simulation-outputs"><strong>2.6. Simulation outputs</strong></a></li>
  <li><a href="#introduction-to-netcdf-files" id="toc-introduction-to-netcdf-files" class="nav-link" data-scroll-target="#introduction-to-netcdf-files"><strong>2.7. Introduction to NetCDF files</strong></a></li>
  <li><a href="#introduction-to-atlantis-variables" id="toc-introduction-to-atlantis-variables" class="nav-link" data-scroll-target="#introduction-to-atlantis-variables"><strong>2.8. Introduction to Atlantis variables</strong></a></li>
  <li><a href="#tools-and-packages-to-view-and-analyse-atlantis-input-and-output-files" id="toc-tools-and-packages-to-view-and-analyse-atlantis-input-and-output-files" class="nav-link" data-scroll-target="#tools-and-packages-to-view-and-analyse-atlantis-input-and-output-files"><strong>2.9 Tools and packages to view and analyse Atlantis input and output files</strong></a></li>
  <li><a href="#troubleshooting-on-installation-and-running" id="toc-troubleshooting-on-installation-and-running" class="nav-link" data-scroll-target="#troubleshooting-on-installation-and-running"><strong>2.10. Troubleshooting on installation and running</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">2. INSTALLATION AND RUNNING</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="how-to-check-out-and-install-the-code" class="level2">
<h2 class="anchored" data-anchor-id="how-to-check-out-and-install-the-code"><strong>2.1 How to check out and install the code</strong></h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>AR note: as of 2025 this section is no longer current as we moved to GitHub. Update ASAP.</p>
</div>
</div>
<p>Atlantis is dynamic and new modifications are introduced almost every month. In addition, Atlantis can run on Windows, Mac and Linux (Unix) operating systems. Therefore, you cannot download one executable, but have to check out and compile the code yourself. This ensures that you have the latest version of the code (and please remember to update it regularly!) with all associated libraries required to run Atlantis. As new functionality is added to Atlantis, sometimes code updates also means that new parameters must be added to the parameter files. While this can be frustrating, it is still highly recommended to update the code at least once a month, as updates also include bug fixes. To keep informed on new parameters the users are advised to subscribe to Atlantis wiki blog posts. In addition, if you need help from the model developers you are much more likely to get help quickly if they don’t have to update your model first!</p>
<p>Atlantis source code is hosted in a subversion (abbreviated as SVN) repository. SVN is a commonly used version control system that is used to manage the collections of files that are changed over time. It keeps a history of the code base and the changes that have been made to it, so developers can recall past code versions for reproducibility. It also allows several people to work on the code simultaneously and merge it back together. <strong>As a normal user you will have read-only access to the Atlantis code repository.</strong></p>
<p>If you want <strong>to modify the code</strong>, please check out wiki for instructions on how to create a <a href="https://confluence.csiro.au/display/Atlantis/Switch+working+copy+to+another+branch">new branch</a> from your working copy or <a href="http://svnbook.red-bean.com/en/1.5/svn.branchmerge.basicmerging.html">merge</a> your modifications with new updates. The Atlantis wiki also has more information on modifying the code, such as creating and adding <a href="https://confluence.csiro.au/display/Atlantis/Add+a+input+parameter">a new input parameter</a> or adding <a href="https://confluence.csiro.au/display/Atlantis/Adding+a+new+GroupType">a new type of functional groups</a>.</p>
<p>To check out the code and install the code on your computer follow these steps:</p>
<p><strong>1. Get access to Atlantis SVN repository</strong> by joining the <a href="https://confluence.csiro.au/display/Atlantis/Atlantis+Ecosystem+Model+Home+Page">Atlantis Wiki</a>, signing the user licence agreement and requesting <a href="https://confluence.csiro.au/display/Atlantis/CSIRO+licence+and+repository+request">access to the SVN</a> repository. The response time on this should not take more than a couple of days (if it does poke Beth again as she is likely on the road and has not seen the email).</p>
<p><strong>2. Check out the code from SVN to your computer.</strong> Experienced users can check out the code by using svn commands through a command line terminal (dos or terminal window). Alternatively, you can use special software to make things easier.</p>
<p><strong>Windows</strong> users can use the free package <a href="http://tortoisesvn.tigris.org/">TortoiseSVN</a>, which works like a plugin for Windows Explorer. To check out the code with TortoiseSVN first install it on your computer. Next, create a new folder where you will keep the code, e.g.&nbsp;C:/AtlantisCode. Rick-click the mouse on this folder and chose “SVN Checkout…” option. This will bring up the TortoiseSVN menu:</p>
<p><img src="media/image3.png" style="width:4.15625in;height:3.02917in"></p>
<p>Enter the URL of the code depository, provided on the Atlantis Wiki source code <a href="https://confluence.csiro.au/display/Atlantis/Getting+the+source+%20code">page</a>, making sure the directory to install the code on your computer is correct, and chose “Fully recursive” Checkout Depth and “HEAD revision”. Detailed instructions on how to check out the code with TortoiseSVN are available on the wiki (<a href="file:///C:\HY-Data\ASAUDZIJ\documents\manual\HYPERLINK%20%22https:\confluence.csiro.au\display\Atlantis\TortoiseSVN">here).</a></p>
<p><strong>Mac</strong> users can check out the code using the app <a href="http://versionsapp.com/">Versions</a>, while Linux users can use <a href="http://svnbook.red-bean.com/en/1.6/svn.ref.svn.c.checkout.html">RedBean</a>.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>When updating the code, make sure you always update to your main directory where all your code is located, such as C:/AtlantisCode, rather than any subfolders within it. This will ensure that libraries are updated properly.</p>
</div>
</div>
<p><strong>3. Install software for compiling the code.</strong> Compiling Atlantis code in Windows and Linux operating systems is easy. It is <strong>a lot harder to set up on Mac operating</strong> systems (although once installed everything runs smoothly enough).</p>
<p>Windows users can build the code using freely available Microsoft Visual Studio software. Currently supported versions are 2005/2008/2010/2012 and, as of March 2016, you can download 2010 and 2012 Visual Studio installers from the Atlantis wiki by clicking on <a href="https://confluence.csiro.au/pages/viewpageattachments.action?pageId=43155524&amp;metadataLink=true">the paperclip sign</a> on the <a href="https://confluence.csiro.au/display/Atlantis/Building+under+windows">wiki</a>.</p>
<p>Instructions for software and building Atlantis under Linux and other platforms are available <a href="https://confluence.csiro.au/display/Atlantis/Building+Atlantis">on the wiki</a>. If you are a Mac user you may find the use of comfort food at this stage a good idea, each Mac installation appears to face its own challenges, sometimes it goes very easily other times you can spend a day or more wrestling to get one of the supporting libraries to work with your architecture. There does not seem to be any rhyme or reason to this! Macs are just special that way.</p>
<p><strong>4. Install the NetCDF 4 libraries.</strong> These libraries are required for running Atlantis. Detailed instructions on installing NetCDF and updating the path are available <a href="https://confluence.csiro.au/display/Atlantis/NetCDF+4+in+Windows">on the wiki</a>. It is very important that you do this properly, as Atlantis will not run otherwise. Windows users can download pre-compiled libraries, Mac and Linux users will need to down load the source and compile locally.</p>
<p><strong>5. Compile the code.</strong> In Windows compiling the code does not require any programming skills. All you need to do is double-click the Visual Studio SLN file (chose the version suitable for your Visual Studio, e.g.&nbsp;Atlantis_VS2010.sln) located in the main directory of where you checked out the code (e.g.&nbsp;C:\programs\Atlantis). This will load the project into Visual Studio. Then go to the Visual Studio Build menu and chose “Build Solution”. Detailed instructions are given on Atlantis Wiki <a href="https://confluence.csiro.au/%20display/Atlantis/Building+Atlantis">building</a> page.</p>
<p><img src="media/image4.jpg" style="width:5.14151in;height:3.63653in"></p>
<p>Once the build has successfully completed you will find the latest executable <em>atlantismain.exe</em> in C:\...\Atlantis\atlantismain\Debug folder (where … indicates your designated directory for the code)</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>You will need to recompile or build the code anew every time you update it from the SVN repository.</p>
</div>
</div>
<p>On Linux (and Mac) platforms GCC is recommended for compiling the code. Other options for compiling are also available for users who for any reason do not want to use Microsoft Visual Studio or GCC. These options include the <a href="https://confluence.csiro.au/display/Atlantis/Using+the+Intel+Compiler">Intel compiler</a> and <a href="https://confluence.csiro.au/display/Atlantis/Building+under+cygwin">Cygwin</a>. However, these are not recommended compilers and users will potentially have to work out solutions to issues themselves.</p>
<p><strong>6. Create a directory for your simulations.</strong></p>
<p>This is where you will keep all your parameters and run outputs. This could be called C:\AtlantisRuns\... This is NOT the same directory as the code itself, so please make sure you understand the difference. If you use several models, such as California, SE Australia and Antarctica, might want to keep parameter files of each model in separate directories, e.g.&nbsp;C:\AtlantisRuns\California\, C:\AtlantisRuns\SE_Australia\ and so on.</p>
<p>Please make sure not to use spaces in the name of the directory (e.g.&nbsp;use C:\AtlantisRuns or C:\Atlantis_Runs not C:\Atlantis Runs as the core code of Atlantis was written before spaces were allowed in directory names and it may not correctly read file names if the directory structure includes spaces<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <a href="https://confluence.csiro.au/display/Atlantis/Sample+input+files"><strong>South East Tasmanian (SETas) model</strong></a> is freely available from the Atlantis SVN repository as a learning tool. It is a simple model with only a few boxes and few functional groups. All required input and parameter files for SETas model can be downloaded from the wiki and used as templates for new model applications.</p>
<p>Make sure you use SVN checkout to download these files. Don’t use the web browser to copy the files. Also make sure you download files for the correct version of the Atlantis code (<em>trunk</em> or <em>bec_dev</em>).</p>
</div>
</div>
<p><strong>7. Check out or copy files of your specific model and latest Atlantis executable into the run directory.</strong></p>
<p>Also copy the latest executable <em>atlantismain.exe</em> from the C:\...\Atlantis\atlantismain\Debug folder into the run directory you created before (e.g.&nbsp;C:\AtlantisRuns).</p>
<p>The executable <strong>must</strong> be in the same directory as the main BAT run file, required to initialise your runs</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make sure you copy the new executable file from …Atlantis\atlantismain\Debug into your run directory every time you update and recompile the code. Forgetting to do this is one of the more common mistakes.</p>
<p>Alternatively, you can insert a line into the start of your BAT file to copy it before the start of each run if you want to make sure you always have the latest version.</p>
<p>This would look like:</p>
<p>copy C:\...your Code directory \atlantismain\Debug\atlantismain.exe</p>
<p>The dot at the end of the line means that the file atlantismain.exe from Debug directory will be copied to the same directory as the BAT file.</p>
<p>See the <a href="https://confluence.csiro.au/display/Atlantis/Windows+Command+Prompt">wiki</a> for details.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Good practice tip 1">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Good practice tip 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>A good practice Atlantis run directory is uncluttered and contains separate folders for:</p>
<p>1) external forcing files or <strong>inputs</strong>. These files are referred to in <em>force.prm</em> file and will rarely need to be modified after the parameterisation of the model. They are usually placed in the ‘inputs’ directory</p>
<p>2) other <strong>parameter</strong> files. These parameters will be listed in the <em>.bat</em> file used to initialise simulations. Depending on the research question, you will probably modify at least some of the biological, harvest or socio-economic parameters in each of the simulations. Although it is not obligatory we suggest that you keep all your parameters in a separate ‘parameters’ directory.</p>
<p>It is a good idea to give parameter files meaningful names. For example, it would be hard to remember what <em>A.prm</em> refers to, whereas <em>Biol_noclimate_change.prm</em> is a lot more informative. However, there is a limit to the length of a filename Atlantis will read-in so if your model won’t run because it can’t find a file and that file does exist but has a long name try shortening the name and see if that helps.</p>
<p><img src="media/image50.tmp" style="width:4.76in;height:2.73311in"></p>
</div>
</div>
</section>
<section id="input-files" class="level2">
<h2 class="anchored" data-anchor-id="input-files"><strong>2.2. Input files</strong></h2>
<p>Atlantis input files come in six file formats:</p>
<ol type="1">
<li>BGM file defining model geometry (see chapter 3)</li>
<li>NC initial conditions and forcing files (see chapter 2.8)</li>
<li>CSV files defining biological and fisheries groups (see chapter 6)</li>
<li>PRM files listing flags to activate optional calculations and parameters values (described in detail in subsequent chapters)</li>
<li>TS files defining time series of external forcing drivers (see chapter 8)</li>
<li>BAT file used to initiate the run (see chapter 2.5)</li>
</ol>
<p>All files except for NC files can be opened and edited using any basic text editing software (such as TextPad or NotePad). Until recently this was the usual way to setup and modify model parameters. However, some PRM files are thousands of lines long, which means that hand editing can be tedious and a source of error. New R-based tools are currently under development to help users visualise and modify parameter files in a more streamlined way (see below)</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>PC, Mac and Unix computers use different syntax to indicate line end.</strong> This means that should you receive files from someone using a different operating system, the PRM files will have to be converted to match your local operating system. In Linux this can be done using the <a href="https://confluence.csiro.au/display/Atlantis/File+Formats">‘flip’ software</a>. If you only have a few files this can be done by simply opening the parameter files in a text editor (e.g.&nbsp;TextPad in Windows or TextWrangler in Mac) and saving them in a format suitable for your operating system (see menu “File Format”). More info on line terminators can be found on the wiki <a href="http://en.wikipedia.org/wiki/Newline">here</a> or by searching in your favourite search engine.</p>
<p><img src="media/image60.tmp" style="width:5.888in;height:3.82256in"></p>
</div>
</div>
</section>
<section id="overview-of-atlantis-submodels-and-the-main-routine" class="level2">
<h2 class="anchored" data-anchor-id="overview-of-atlantis-submodels-and-the-main-routine"><strong>2.3. Overview of Atlantis submodels and the main() routine</strong></h2>
<p>Detailed descriptions of Atlantis submodels and specific input files are provided in subsequent chapters. For a start you need to understand which of the files are required to set up a simple simulations and what they mean (<strong>Error! Reference source not found.</strong>). The figure below gives a schematic of the Atlantis submodels overlaid one over another. At the very basis there is the model geometry, Physics and Biogeochemical (Biology and Ecology) submodels. The other, optional, submodels use their outputs to simulate the human domain.</p>
<p><img src="media/image7.jpg" style="width:6.69306in;height:4.50833in"></p>
<p><span id="_Ref445803305" class="anchor"></span><strong>Figure 2.</strong> Schematic representation of the Atlantis model structure and input files. Submodels coloured in green are obligatory. Files marked with * are required, others are optional.</p>
<p>The 3D structure of your model domain, or <strong>Model Geometry</strong>, is described in the BGM file. The model geometry is used to simulate all processes in the five submodels.</p>
<p><strong>Physics</strong> and <strong>Biology</strong> submodels are required (although you can switch some parts off for debugging purposes), whereas <strong>Harvest</strong>, <strong>Assessment</strong> and <strong>Economics</strong> submodels are optional. Each submodel has a specific PRM file describing parameters used in it. Biology and Harvest submodels also require a list of the relevant groups, such as biological functional groups or list of fisheries, in the CSV format.</p>
<p><strong>Initial conditions</strong> are the spatially explicit starting values for all modelled state variables (e.g.&nbsp;spatial distribution of numbers of age 1 cod at the start of your simulations). The initial conditions are specified in the initial condition NC file<strong>.</strong></p>
<p>In addition, all simulations require two supporting files <em>force.prm</em> and <em>run.prm</em> (see below for a brief description of all parameter files).</p>
<p>The <em>main()</em> routine is in the <strong>atlantismain.c</strong> file in the <strong>atlantismain</strong> library. It calls in a set order all other routines that initialise and run the requested submodels and routines and write output files. Each submodel and their main routines will be described in detail below, but a general overview is given in Fig. 3.</p>
<p><img src="media/image8.jpeg" style="width:6.96528in;height:5.37153in"></p>
<p><span id="_Toc526762783" class="anchor"></span><strong>Figure 3.</strong> Brief overview of the Atlantis <em>main()</em> routine that calls other routines implemented in various submodels.</p>
</section>
<section id="delving-into-the-code-finding-the-files-and-routines-that-describe-the-processes-you-are-interested-in" class="level2">
<h2 class="anchored" data-anchor-id="delving-into-the-code-finding-the-files-and-routines-that-describe-the-processes-you-are-interested-in"><strong>2.4. Delving into the code: finding the files and routines that describe the processes you are interested in</strong></h2>
<p>This chapter aims to give a very brief introduction into the Atlantis code. You do not need to use the code to run simulations. However, if you can navigate around the code and find routines that use the parameters and execute the processes you are interested in, it will most helpful and informative. In the end, this is the best way to understand what exactly the model does.</p>
<p>Of course, reading the code will require at least some programming skills. Check out a number of C tutorials available online for basic understanding about programming and C. The internet is an ever changing place so the best idea is to use your favourite search engine to find some good c tutorials for someone with your level of coding experience. At time of writing the following were potentially helpful sites <a href="http://www.cprogramming.com">www.cprogramming.com</a> and <a href="http://www.tutorialspoint.com/cprogramming">www.tutorialspoint.com/cprogramming</a> and <a href="http://www.imada.sdu.dk/~svalle/courses/dm14-2005/mirror/c/">www.imada.sdu.dk/~svalle/courses/dm14-2005/mirror/c/</a></p>
<p>However, even without a background in c coding, two approaches might be useful in starting to navigate through the code.</p>
<p>The first is the <strong>Search</strong> tool. In Visual Studio (or GCC, or another package) go to Edit-&gt;Find and Replace-&gt;Quick Find, or simply click Ctrl+F. This will bring up the Search menu where you type in the search string, such as the name of parameter.</p>
<p>In the example below, we search for the include_atmosphere parameter, used in the <em>physics.prm</em> file. Make sure you search in the “Entire Solution” if you want to browse through the whole code. You can either scroll through the entire list of search results and click directly on the line of interest (if you have some familiarity with the code) or you can click “Find Next” (if you go this route you may need to click a few times to finally get to one of the routines that uses the parameter). For example for include_atmosphere the relevant routine is called <em>Amonium_ROC()</em>, which is indicated on the top right drop-down menu in Visual Studio, and it is located in the file <strong>atNutrient.c</strong></p>
<p><img src="media/image9.tmp" style="width:6.69306in;height:3.32083in">Here we can see that if include_atmosphere flag is on (set to 1) the code will transfer NH3 values from the atmosphere into the surface cell.</p>
<p>The second approach is to simply browse the libraries, files and routines you might be interested in. Of course, to do this you will need to know the names of routines. This can be done by searching for relevant parameters as shown above or by looking in the drop down list of routine names (most GUIs for interrogating code have such a feature).</p>
<p>As an example we will look at the formulation of the respiration processes in fully age structured groups.</p>
<p>Once you open your solution file in Visual Studio C++, expand the submodel <strong>atecology</strong> (<strong>1.</strong>) and double click the <strong>atvertprocesses.c</strong> file (<strong>2.</strong>). The file will be opened (<strong>3.</strong>) and on the right side you have a drop-down menu to browse through the routines defined in the file (<strong>4.</strong>). By clicking on the <em>Fish_Respiration()</em>routine you will find the description of parameters and equations used to calculate it Note that the first reference to <em>Fish_Respiration()</em> in the drop-down menu has a small arrow next to it. By clicking on this option you will find where in the code the routine is called.</p>
<p>By exploring the code for the routine (<strong>5.</strong>) you can see that the routine needs variables calculated or defined elsewhere in the code, such as <em>guildcase</em>, <em>SN</em>, <em>RN</em>, <em>Dens</em> and <em>*respire</em>, these variables are described within the parentheses <em>( )</em> right after the routine name. The routine also uses six parameters – <em>KA_id</em>, <em>KB_id</em>, <em>KST_id</em>, <em>Ktmp_id, Kthresh2</em> and <em>X_CN</em>. You can find them in the biological parameters file by replacing the ‘<em>id</em>’ with your functional group abbreviation (e.g.&nbsp;<em>KA_FCD)</em>, as defined in the functional group .csv file. Sometimes the <em>_id</em> represents larger categories, such as _fish or _shark, as is the case for <em>KST_fish</em>, but you should be able to work it out by searching for the parameter name.</p>
<p><img src="media/image10.jpeg" style="width:6.95278in;height:5.21458in"></p>
<p>Now you only have to look through the equations and explore different parameter values in R or Excel, or on a piece of paper, and assess the shape of the response curve to different parameter values.</p>
<p>Another useful tool in exploring the code is the <strong>Call Hierarchy</strong> tool. It allows you to see the routines that call or are called from the routine of your interest. In Visual Studio this can be called by clicking the right mouse button while holding the pointer over the routine name and selecting “View Call Hierarchy” option. In the example below, we can see that routine <em>Vertebrate_Activities()</em> is called from <em>Do_Vertebrate_Living()</em> routine, and that many other routines are called from <em>Vertebrate_Activities()</em></p>
<p><img src="media/image11.tmp" style="width:6.69306in;height:3.87917in"></p>
</section>
<section id="how-to-setup-and-start-simulations" class="level2">
<h2 class="anchored" data-anchor-id="how-to-setup-and-start-simulations"><strong>2.5. How to setup and start simulations</strong></h2>
<section id="crash-introduction-into-command-line-interfaces" class="level3">
<h3 class="anchored" data-anchor-id="crash-introduction-into-command-line-interfaces"><em>2.5.1. Crash introduction into Command line interfaces</em></h3>
<p>Atlantis is an “old style” program that runs from a command line. This is done using "<a href="https://confluence.csiro.au/display/Atlantis/Windows+Command+Prompt">Command Prompt</a>" on Windows or "<a href="http://guides.macrumors.com/Terminal">Terminal</a>" on a Mac or Linux. Please familiarize yourself with the command line interface and how to navigate among folders. For most uses you only need to know a few commands and can pick up the required skills in a few minutes. There are plenty of online tutorials to quickly learn about the Command line interface for your operating system (e.g.&nbsp;tutorial.djangogirls.org/en/intro_to_command_line/). Here are a few commands just to get you going (in fact you do not really need much more than that).</p>
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th colspan="2"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><strong>What to type:</strong></p>
<p>cd\</p>
<p>cd..</p>
<p>cd C:\AtlantisRuns</p>
<p>cd C:\A + <strong>TAB</strong> key</p>
<p>(type letter A and keep pressing TAB key)</p>
<p>Press arrows up and down</p>
<p>C:</p></td>
<td><p><strong>What this does:</strong></p>
<p>go to the root directory of the drive you are currently in</p>
<p>go one directory level up</p>
<p>go to the specified directory</p>
<p>scroll through all folders within <strong>C:</strong> that start with A (case insensitive). This way you don’t need to type long folder names (and make spelling mistakes)</p>
<p>go to the previously typed commands</p>
<p>Go to drive C: from any other drive you are in</p></td>
</tr>
<tr class="even">
<td><strong>Note:</strong> In Mac and Linux use / instead of \</td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="setting-up-the-bat-file" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-bat-file"><em>2.5.2. Setting up the BAT file</em></h3>
<p>At this stage you already have 1) compiled the code on your machine, 2) created a run directory for your simulations (C:\AtlantisRuns\MyModel), 3) copied all input and parameter files into the run directory, 4) copied the Atlantis executable (atlantismain.exe) from C:\...\atlantismain\Debug into your run directory.</p>
<p>The next step is to create a BAT file such as <em>run.bat</em> (or any name you want, e.g.&nbsp;<em>NoFishing.bat</em>) and then call it from the command prompt to initialise the simulations. <strong>The BAT file must be in the same directory as the Atlantis executable.</strong></p>
<p>The easiest way to setup and modify the .bat file is in a text editor.</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th><p>The BAT file initialising Atlantis simulation has one long command line calling the Atlantis executable and giving the names of the parameter files required for the run. For example in windows the command would look like:</p>
<p><em><strong>atlantismain.exe -i MySea_initial.nc 0 -o simulationOutput1.nc -r MySea_run.prm -p MySea_physics.prm -f MySea_force.prm -b MySea_biol.prm</strong> -m MySea_migrations.csv <strong>-s Functional_groups.csv</strong> -h MySea_harvest.prm -q MyFisheries.csv –a MySea_assess.prm –e MySea_econ.prm -d OutputFolder1 -t C:\AtlantisRuns\parameters</em></p>
<p>Required parameters and files are shown <strong>in bold</strong>, optional parameters are in regular font.</p>
<p>You will still have to make sure that correct paths of forcing files (for hydrodynamics, salinity, temperature and others) are given in the <em>force.prm</em> file. In the <em>force.prm</em> file the path of the inputs/ folder name often has to given as ../inputs/ which tells the program that the inputs/ folder is in the same higher level directory as the <em>force.prm</em> file.</p>
<p>While the <em>migrations.csv</em> file is marked as optional here, it is usually used as most models include some form of migration into/out of the model.</p></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>If the <em>–t &lt;name of folder containing parameter files&gt;</em> is omitted then Atlantis will expect to find the parameter files in the same directory as the batch file used to run the model. If the Atlantis executable is formally installed after it is compiled (e.g.&nbsp;using sudo make install in <a href="https://confluence.csiro.au/display/Atlantis/Building+under+linux">Linux</a> or adding it to the Windows recognised path names, see the <a href="https://confluence.csiro.au/display/Atlantis/Building+under+windows">wiki</a>) then you do not need to copy the executable file to the run directory and you only need to type the name of your Atlantis executable (e.g.&nbsp;<em>atlantismain</em> in the example) rather than name.exe in the command line.</p>
<p>Names of the parameter files must be given after an appropriate one letter argument which indicates what the following filename represents. For example, <strong><em>-i</em></strong> tells the executable that the following filename is the input file that details initial conditions. The actual names of the parameter files are flexible, as long as the file extensions are correct. For example, the initial conditions file could be named as initial_conditions.nc, start_of_the_run.nc, start_of_the_fun.nc, a.nc or fred.nc. It does not matter so long as it is an NC file. It is <strong>only</strong> the one letter flag command (e.g.&nbsp;-i, -o, -p and others) preceding the filename that tells Atlantis which kind of file to expect.</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th><p>For example, your BAT file could look like the following and it will run perfectly well:</p>
<p><em><strong>BestModellingTool.exe -i BigBang.nc 0 -o TheLastSimulationEver.nc -r HowToRun.prm -p CleverPhysics.prm -f AllThoseInputs.prm -b EatEachOther.prm -s Critters.csv</strong> -m OurMovements.csv -h HowToCatchFish.prm -q Fishers.csv –a TryToAssess.prm –e MBAdomain.prm -d PutEverythingHere -t C:\AtlantisRuns\parameters</em></p></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p><strong>Don’t forget to add number 0 after the name of the initial conditions file.</strong> This requirement is a legacy of the model development, and Atlantis will not run without it.</p>
<p>By default all simulation outputs will be placed in the same folder as the BAT file, but you can create an optional output folder (<em>-d OutputFolderName</em>). Specifying output folders is really important when running batch simulations (see below).</p>
</section>
<section id="parameter-files-called-in-the-bat-command-line" class="level3">
<h3 class="anchored" data-anchor-id="parameter-files-called-in-the-bat-command-line"><em>2.5.3. Parameter files called in the BAT command line</em></h3>
<p>This section gives a brief description of the parameter files. They will be described in further details in subsequent chapters:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 2%">
<col style="width: 97%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong><em>-i</em></strong></th>
<th style="text-align: left;">initial conditions of your model run, including physical water column properties, seabed properties and biomasses and size per group per box</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong><em>-o</em></strong></td>
<td style="text-align: left;">provides a name for the output files. Please make this an nc file (e.g.&nbsp;<em>simulationOutput1.nc</em>). Atlantis will create a lot of different outputs and will append titles of different output files to your specified name using the nc filename as the core of those names (e.g.&nbsp;<em>simulationOutput1BiomInd.txt</em>, <em>simulationOuput1Catches.txt</em>).</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><em>-r</em></strong></td>
<td style="text-align: left;">parameters defining the run setup, such as which modules to turn on (fishery, socio-economics), time step (12 or 24hr), run and stop times, frequency of outputs, flags for debugging and verbosity, details of notes to store in log.txt</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><em>-p</em></strong></td>
<td style="text-align: left;">physics parameters, such as resuspension, point-source scaling, eddy strengths and others. These parameters are not typically changed, although you may want to modify eddy strengths or turn off resuspension.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><em>-f</em></strong></td>
<td style="text-align: left;">forcing file provides pathways to all external (i.e.&nbsp;not simulated within the model) input files, such as hydrodynamics, salinity, temperature, nutrient input sources from river flows or upwelling, climate time series (precipitation, irradiance), historical catch, fuel prices, GDP and complex spatial zoning through time (the list of allowed external forcing files is given the chapter on <em>force.prm</em> below). These files are usually stored in your “inputs” folder.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><em>-b</em></strong></td>
<td style="text-align: left;">ecological parameters, including feeding preferences, distributions, mortality, reproduction and others</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><em>-m</em></strong></td>
<td style="text-align: left;">migration parameters (used to be inside the <em>biology.prm</em> file)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><em>-s</em></strong></td>
<td style="text-align: left;">list of functional biological groups and their key characteristics, such as number of age groups</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><em>-h</em></strong></td>
<td style="text-align: left;">parameters on fishing fleets, target species, catch history, discards, changes in selectivity over time, etc. Note that if you use external forcing of catch or fishing mortality, those forcing files must be specified in the <em>force.prm</em> file and not in the <em>harvest.prm</em> file</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><em>-a</em></strong></td>
<td style="text-align: left;">sample design, sampling error structures and basic assessment model parameters</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><em>-e</em></strong></td>
<td style="text-align: left;">socio-economics parameters for fleet dynamics, market model, trading model, and black-book based effort allocation model</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong><em>-d</em></strong></td>
<td style="text-align: left;">an optional destination folder. If provided, a new folder with this name will be created during the run and all outputs placed in this folder. Using this option is highly recommended</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong><em>- t</em></strong></td>
<td style="text-align: left;">an optional, but recommended folder, for storing input parameters (see Good Practice Tip 1). If this folder is not provided, all parameters (not inputs) must be in the same directory as the Atlantis bat file, if Atlantis has been formally installed to the command line, or in the same directory as the executable if you are simply copying the exe file to the run directory.</td>
</tr>
</tbody>
</table>
<p>Note, the <strong>forcing files</strong> (such as hydrodynamics, temperature, catch, recruitment and other forcing files) are not included in the <em>BAT</em> command line, because they are all listed in the <em>force.prm</em> file</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th><p><strong>Good practice tip 2</strong></p>
<p>It is a good idea to give informative names to the parameter files. This way you can remember changes made in them. For example, <em>Baltic_biol_CodMort05.prm</em> could denote a biological parameter file with cod mortality set to 0.5. Also make sure you rename the parameter file if you modify it. This will help you keep track of which parameter combination was used for each simulation.</p>
<p>It is <strong>strongly recommended that you keep a good record of all parameter modifications</strong> and outcomes they had on model simulations. We cannot stress this strongly enough! Almost every modeller has experienced difficult moments when trying to trace back what exactly was done at different steps of model development or scenario analyses.</p></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</section>
<section id="setting-up-batch-simulations" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-batch-simulations"><em>2.5.4. Setting up batch simulations</em></h3>
<p>To set up <strong>batch simulations</strong>, simply add more command lines in your BAT file:</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th><p><em>atlantismain.exe -i MySea_initial.nc 0 -<strong>o NoFishing.nc</strong> -r MySea_run.prm -p MySea_physics.prm -f MySea_force.prm -b MySea_biol.prm -s Functional_groups.csv -<strong>h MySea_harvestNoFishing.prm</strong> -q MyFisheries.csv -a MySea_assess.prm -e MySea_econ.prm -<strong>d OutputNoFishing</strong> -t C:\AtlantisRuns\parameters</em></p>
<p><em>atlantismain.exe -i MySea_initial.nc 0 <strong>-o MedFishing.nc</strong> -r MySea_run.prm -p MySea_physics.prm -f MySea_force.prm -b MySea_biol.prm -s Functional_groups.csv -<strong>h MySea_harvestMedFishing.prm</strong> -q MyFisheries.csv –a MySea_assess.prm -e MySea_econ.prm -<strong>d OutputMedFishing</strong> -t C:\AtlantisRuns\parameters</em></p>
<p><em>atlantismain.exe -i MySea_initial.nc 0 -<strong>o HighFishing.nc</strong> -r MySea_run.prm -p MySea_physics.prm -f MySea_force.prm -b MySea_biol.prm -s Functional_groups.csv -<strong>h MySea_harvesHighFishing.prm</strong> -q MyFisheries.csv -a MySea_assess.prm -e MySea_econ.prm -<strong>d OutputHighFishing</strong> -t C:\AtlantisRuns\parameters</em></p></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>Batch simulations would normally have some differences between runs (<strong>shown in bold</strong> in the example above). Make sure you place each output in a different folder (-d) and don’t overwrite it! Also make sure you carefully check your command lines to ensure you call the correct parameter files. It is really disappointing to wait for a few days for your batch simulation outputs just to realise that the BAT file had wrong combinations of parameter files in it!</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th><p><strong>NOTE!</strong></p>
<p>If you run a lot of simulations it is good idea to keep your BAT files handy, so you can easily trace the parameter combinations used. The LOG file produced for each simulation includes the command line of the BAT file. However, some users find it convenient to add new commands to the BAT file and comment (deactivate) the old ones out with # sign.</p>
<p><em><strong>#</strong>atlantismain.exe -i MySea_initial.nc 0 -o NoFishing.nc -r MySea_run.prm -p MySea_physics.prm -f MySea_force.prm -b MySea_biol.prm -s Functional_groups.csv -h MySea_harvestNoFishing.prm -q MyFisheries.csv -a MySea_assess.prm -e MySea_econ.prm -d OutputNoFishing -t C:\AtlantisRuns\parameters</em></p>
<p><em>atlantismain.exe -i MySea_initial.nc 0 <strong>-o MedFishing.nc</strong> -r MySea_run.prm -p MySea_physics.prm -f MySea_force.prm -b MySea_biol.prm -s Functional_groups.csv -<strong>h MySea_harvestMedFishing.prm</strong> -q MyFisheries.csv –a MySea_assess.prm -e MySea_econ.prm -<strong>d OutputMedFishing</strong> -t C:\AtlantisRuns\parameters</em></p>
<p>In this example, Atlantis will skip the first line and will only execute the second one (where the fishing parameters, harvest and output files are changed). This way you can easily keep a record of parameter combinations used in earlier simulations. Of course, if you run dozens of simulations at some point this BAT file will get too long and cluttered and you will need a different bookkeeping system (but make sure you have some system to trace each parameter combination in each simulation!)</p>
<p>Note, that the line here refers to the whole command string, separated by line spaces. One command line is wrapped into four lines in the example above, but it does not contain any line breaks.</p></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
</section>
<section id="initialising-simulations" class="level3">
<h3 class="anchored" data-anchor-id="initialising-simulations"><em>2.5.5. Initialising simulations</em></h3>
<p>Once you have all the input and parameter files, EXE and BAT files ready, open the Command Prompt (or Terminal) window, navigate to your model run directory that has the BAT files in it (and the EXE if you have not formally installed Atlantis to the command line paths), type the name of your BAT file and press ENTER.</p>
<p><img src="media/image12.tmp" style="width:6.10377in;height:2.94822in"></p>
<p>Atlantis should start running now! If all is going well, you should be getting short daily messages, looking like this (45.5 days are completed below):</p>
<p><img src="media/image13.tmp" style="width:5.6691in;height:2.77083in"></p>
<p>When the run is complete, Atlantis will finalise writing all the outputs, free arrays and close (the simulation below was run for 20 days):</p>
<p><img src="media/image14.tmp" style="width:5.44in;height:3.48958in"></p>
<p>If, for some reason you need to stop your run before it is finished, go to the output folder and delete the file called “<strong><em>delete_to_halt_run</em></strong>”. This way Atlantis will write all the outputs to date and free memory before stopping the simulation. If you stop Atlantis any other way the files will not be completed properly and will most likely be uselessly incomplete.</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th><p><strong>NOTE!</strong></p>
<p>During the simulations Atlantis runs many outputs into its internal memory. This means that even though all the output files are created at the beginning of the simulation, they may not contain much information until the runs are actually finished. So, do not get disturbed if you want to peek into some output file during the simulation and find it empty, even if the simulation has already been running for a long time.</p></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>Don’t despair if the simulation does not start so smoothly. Error messages are an important part of this adventure! Check out the chapter on troubleshooting and the dedicated Atlantis wiki <a href="https://confluence.csiro.au/display/Atlantis/Common+Windows+Build+Errors">page</a></p>
</section>
</section>
<section id="simulation-outputs" class="level2">
<h2 class="anchored" data-anchor-id="simulation-outputs"><strong>2.6. Simulation outputs</strong></h2>
<p>Once the simulation finishes Atlantis will generate <strong>a lot of</strong> <strong>output files</strong> in TXT and NC formats. The simulation output folder will also contain the <em>log.txt</em> file (with various details or messages generated during the run), as well as <em>exports.ts</em> and <em>inputs.ts</em>, which store information on flows into/out of the model domain, and a number of XML files, which are mostly just automatically generated files that are converted input files restructured to a format that Atlantis can more easily read in. Most users never touch the TS and XML output files. The XML files might be a useful means of storing the input parameters in a database but are otherwise of little ongoing use. The TS files however can be quite informative for showing how much material enters and exits the domain due to advection.</p>
<table class="caption-top">
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th><p><strong>NOTE!</strong></p>
<p>The <em>log.txt</em> file does not start with the name given in the <strong><em>–o</em></strong> command. This means that if you accidentally start another simulation with the same output folder name (or without giving the output folder), the <em>log.txt</em> file will be overwritten.</p></th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p><img src="media/image15.tmp" style="width:6.08472in;height:7.94028in">The list of output files in your output folder will look like this (it indeed has <strong>a lot of</strong> outputs!):</p>
<p>The table below lists the main output files. Some output files will be produced only if relevant flags are active (e.g.&nbsp;evolution, different management or fisheries options) and are not included in the table.</p>
<p><span id="_Toc445899521" class="anchor"></span></p>
<p>Table 3. Main Atlantis output files. The main output files of interest for beginner users are shown in grey boxes. The table first lists Biology related outputs and then Harvest submodel related outputs. Please note, that the list of output files are continuously updated, so check the <a href="https://confluence.csiro.au/display/Atlantis/Atlantis+Output+Files">wiki</a> for any changes.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 4%">
<col style="width: 63%">
<col style="width: 4%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Name</strong></th>
<th><strong>Contents</strong></th>
<th><strong>Units</strong></th>
<th><strong>Comments</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BiomIndx.txt</td>
<td><strong>Snapshots</strong> of biomasses of all active species (set in the <em>functional_groups.csv</em> file) across the entire model domain, excluding boundary boxes. Usually this is the first file to explore, but don’t forget to look at the box-specific biomasses!</td>
<td>tonnes</td>
<td>Frequency of output controlled with tsumout in <em>run.prm</em></td>
</tr>
<tr class="even">
<td>BoxBiomass.txt</td>
<td><strong>Snapshots</strong> of biomasses of all active species for each of the model domain boxes, excluding boundary boxes</td>
<td>tonnes</td>
<td>Frequency of output controlled with tsumout in <em>run.prm</em></td>
</tr>
<tr class="odd">
<td>AgeBiomass.txt</td>
<td><strong>Snapshots</strong> of biomasses of all active species per age group across the entire model domain</td>
<td>tonnes</td>
<td><p>This output is given if</p>
<p>flag_age_output is set to 1 in <em>run.prm</em></p></td>
</tr>
<tr class="even">
<td>DietCheck.txt</td>
<td>Proportional make up of a diet of each age class of each functional group. This is the cumulative proportion since the last output</td>
<td>propor-tion</td>
<td>The total sum for each age group is 1 for all prey items</td>
</tr>
<tr class="odd">
<td>DetailedDietCheck.txt</td>
<td>If flagdietcheck is set to 1 then this returns the total consumed biomass since the last output given for each cell (box and layer) of each age group of each functional group. If flagdietcheck is set to 2 then it is the proportional makeup of the diet instead.</td>
<td><p>tonnes or</p>
<p>propor-tion</p></td>
<td>Very useful for understanding model dynamics. Check out R codes for querying these outputs (chapter 2.9)</td>
</tr>
<tr class="even">
<td>Mort.txt</td>
<td>Annual predation (-M) and fishing (-F) mortality of each functional group. This file is currently only useful for looking at <strong>relative M vs F values</strong> for a species, as it does not give accurate mortalities</td>
<td>per year</td>
<td>Note, that if a species is set as isImpacted in the <em>functional_groups.csv</em> file, it will have some F value even if it is not explicitly targeted by fishing.</td>
</tr>
<tr class="odd">
<td>SpecificMort.txt</td>
<td><p>Three values of instantaneous mortality for each functional group, age group and stock. M2 is predation mortality, M1 other natural mortality (starvation, linear mortality), F is fishing mortality.</p>
<p>At present the M and F values for this output are written <strong>before</strong> Atlantis checks that consumption and fishing are not trying to take more than is available in each cell. This means that <strong>M or F in the file can sometimes exceed 1</strong>. This will be corrected in a future release of Atlantis as the code is restructured.</p></td>
<td><p>per</p>
<p>year</p></td>
<td>At this stage the file is useful only as an <strong>indication of relative morality</strong> for qualitative mortality assessment (high/low)</td>
</tr>
<tr class="even">
<td>SpecificPredMort.txt</td>
<td><p><strong>Cumulative</strong> predation mortality of each stock and age group of each functional group (in rows) as imposed by each predator (in columns) over the course of a year.</p>
<p>As with the SpecificMort.txt above, <strong>values can exceed 1</strong>. This will be fixed in the future</p></td>
<td>per year</td>
<td>At this stage the file is useful only as an <strong>indication of relative morality</strong> for qualitative mortality assessment (high/low)</td>
</tr>
<tr class="odd">
<td>YOY.txt</td>
<td>Biomass of recruits per year (which is the same as per spawning event, because a group only spawns once per year) summed over the total model domain. <strong>Snapshot</strong> at the time of spawning, regardless of when the output is written out.</td>
<td>tonnes</td>
<td></td>
</tr>
<tr class="even">
<td>Migration.txt</td>
<td>Total and migrating biomass (and proportion migrating) of migrating groups per adults and juveniles.</td>
<td>tonnes</td>
<td>Data is given for groups that are tagged as migratory in <em>biology.prm</em> file</td>
</tr>
<tr class="odd">
<td>VertSize.txt</td>
<td>Numbers, average sizes and biomass of each migrating age structured group in the model domain at the time of the output. The output does not include sizes or numbers of individuals outside the model at the time of the output.</td>
<td></td>
<td>Data is given for groups that are tagged as migratory in <em>biology.prm</em> file</td>
</tr>
<tr class="even">
<td>.nc</td>
<td>3D (time, box, layer) <strong>snapshots</strong> of the tracer values at the time of the output</td>
<td>mg/m<sup>3</sup> or numb</td>
<td>Frequency of output controlled with toutinc in <em>run.prm</em> file</td>
</tr>
<tr class="odd">
<td>TOT.nc</td>
<td>2D (time, box) <strong>snapshots</strong> of tracer values per box (summed over layers)</td>
<td>tonnes/km<sup>2</sup> or numb</td>
<td>Frequency of output controlled with toutinc in <em>run.prm</em> file</td>
</tr>
<tr class="even">
<td>PROD.nc</td>
<td>2D (time, box) <strong>snapshots</strong> of diagnostic tracers, such as production and grazing for biomass groups, growth and consumption for each age group for each fully age structured group, and a number of other diagnostic indices</td>
<td><p>mg/m<sup>3</sup>/day</p>
<p>or</p>
<p>mg/day/individ</p></td>
<td>Frequency of output controlled with toutinc in <em>run.prm</em> file</td>
</tr>
<tr class="odd">
<td>ANNAGEBIO.nc</td>
<td>Numbers in each <strong>annual</strong> age class of a species (<strong>NOT</strong> the model age group) per box. This can be useful when tracking annual changes in species that have multiple years per age group. It also records the average size of individuals of the associated model age group per box (i.e.&nbsp;all age classes in the age group are assumed to be of the same individual size)</td>
<td><p>number/box</p>
<p>and g/individ/box</p></td>
<td>The output is written only when flag_age_output is set to 1 in <em>run.prm</em> file</td>
</tr>
<tr class="even">
<td>BoxLight.txt</td>
<td><p>Proportion of sun hours per time step</p>
<p>(how long during that time step there was light)</p></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Catch.txt</td>
<td><strong>Cumulative</strong> total catch per functional group over all commercial fisheries</td>
<td>tonnes</td>
<td></td>
</tr>
<tr class="even">
<td>CatchPerFishery.txt</td>
<td><strong>Cumulative</strong> total catch per functional group per fishery</td>
<td>tonnes</td>
<td></td>
</tr>
<tr class="odd">
<td>Discard.txt</td>
<td><strong>Cumulative</strong> total discards per functional group over all commercial fisheries</td>
<td>tonnes</td>
<td></td>
</tr>
<tr class="even">
<td>DiscardPerFishery.txt</td>
<td><strong>Cumulative</strong> total discards per functional group per fishery</td>
<td>tonnes</td>
<td></td>
</tr>
<tr class="odd">
<td>Effort.txt</td>
<td><strong>Cumulative</strong> number of days each fishery spends fishing</td>
<td>days</td>
<td>Output given only if dynamic effort is turned on in <em>harvest.prm</em> file</td>
</tr>
<tr class="even">
<td>HarvestIndx.txt</td>
<td>Fisheries and management indices, e.g.&nbsp;average size of catch, total landings, total discards, the number of changes in gear, bycatch of threatened or endangered species, habitat impacts, total effort expended, social acceptance, conflict between fisheries sectors, management access, management costs</td>
<td></td>
<td>Many indices only make sense when appropriate fisheries flags are turned on (see chapter on the Harvest submodel)</td>
</tr>
<tr class="odd">
<td>RecCatch.txt</td>
<td><strong>Cumulative</strong> total catch per functional group over all recreational fisheries</td>
<td>tonnes</td>
<td>The fleet must be marked as recreational (isREC) in <em>fisheries.csv</em> file</td>
</tr>
<tr class="even">
<td>SSB.txt</td>
<td><strong>Snapshot</strong> of mature biomass at the time of spawning</td>
<td>tonnes</td>
<td></td>
</tr>
<tr class="odd">
<td>TAC.txt</td>
<td>Total allowable catch per species per year. It can be fixed or dynamic dependent on the fishing scenarios</td>
<td>tonnes</td>
<td>Only written when fisheries use TAC for management, set in flagManage in <em>harvest.prm</em></td>
</tr>
<tr class="even">
<td>BrokenStick.txt</td>
<td>Indices related to broken stick harvest strategy (current F, target F, current biomass and resulting scalar to apply as calculated by the broken stick).</td>
<td></td>
<td>Only written when broken stick harvesting is turned on in <em>harvest.prm</em></td>
</tr>
<tr class="odd">
<td>CATCH.nc</td>
<td><strong>2D</strong> (time, box) file of <strong>cumulative</strong> values of catch and discard per species per fishery in numbers and tonnes per box: catch per species per age group (numbers), discards per species&nbsp;per age group (numbers), catch per species per fishery (tonnes), discards per species per fishery&nbsp;(tonnes)</td>
<td>tonnes or number</td>
<td>Frequency of output controlled with toutfinc in <em>run.prm</em> file</td>
</tr>
<tr class="even">
<td>CATCHTOT.nc</td>
<td><strong>2D</strong> (time, box) file of <strong>cumulative</strong> values of catch, discards and recreational catch per each box</td>
<td>tonnes</td>
<td>Frequency of output controlled with toutfinc parameter in <em>run.prm</em> file</td>
</tr>
<tr class="odd">
<td>ANNAGECATCH.nc</td>
<td>Numbers in each <strong>annual</strong> age class of a species (<strong>NOT</strong> the model age group) per species in the catch and discards. This can be useful when tracking annual changes in number for species that have multiple years per cohort</td>
<td>numb</td>
<td>The output is written only when flag_age_output is set to 1 in <em>run.prm</em> file</td>
</tr>
<tr class="even">
<td>inputs.ts</td>
<td>amount of tracers coming from all boundary boxes and time series into all dynamic boxes</td>
<td></td>
<td>Frequency of output controlled with inputs_tout in <em>run.prm</em> file</td>
</tr>
<tr class="odd">
<td>exports.ts</td>
<td>amount of tracers coming from all dynamic boxes and time series into all boundary boxes</td>
<td></td>
<td>Frequency of output controlled with inputs_tout in <em>run.prm</em> file</td>
</tr>
</tbody>
</table>
</section>
<section id="introduction-to-netcdf-files" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-netcdf-files"><strong>2.7. Introduction to NetCDF files</strong></h2>
<p><a href="https://en.wikipedia.org/wiki/NetCDF">NetCDF (Network Common Data Form)</a> is a set of software libraries and data formats that allow for the creation, access, and sharing of array-oriented scientific data irrespective of type of computer hardware. They are typically used by oceanographers and atmospheric scientists and modellers to store spatial time series information. The NC file format is the computer-readable version, while the CDF format is its unpacked human-readable version that can be viewed and edited with a text editor (such as Notepad or Textpad). The key characteristics of these files are that they are platform-independent and “self-describing”. This means that the file has a header which describes the layout of the rest of the file and array dimensions, followed by sections of data and variable attributes. There are many matlab, R and other tools for interacting with NC files.</p>
<p>The <em>initial_conditions.nc</em> file in Atlantis must list all variables to be tracked throughout the simulation, their initial values or concentrations in the spatial domain, and some of their key characteristics. It is important to get them right. The <em>initial_conditions.nc</em> file is huge and it is not advisable to edit it by hand (see below for tools available to set and modify it). However, it is useful to open and explore the file by converting the NC file to a CDF file.</p>
<p>Two small programs, <strong>ncdump.exe</strong> and <strong>ncgen.exe,</strong> can be used to convert NC files into CDF files (to create human readable and editable files) and from CDF to NC respectively (in case you modified the CDF file and need to convert it back into the computer-readable format). The two packages are included in the NetCDF libraries required for compiling Atlantis (see step 4 in the Chapter 2.1). To convert the files, open the Command Prompt, navigate into the folder that includes the NC or CDF files you want to convert and call the appropriate command with its parameters, as shown below. For example, if you want to convert NC into CDF, type: ncdump.exe somedata.nc &gt; otherdata.cdf. Note, the name of the NC file created by the ncgen.exe, will be the same as the name given in the first line of the CDF file (so NOT necessarily the same name as typed in the command prompt). If you install NetCDF and update the paths as described on the <a href="https://confluence.csiro.au/display/Atlantis/NetCDF+4+in+Windows">wiki</a> the Command Prompt will automatically locate ncdump.exe or ncgen.exe files, so you don’t need to have the EXE files in the same folder as the file you want to convert. The names of the NC and CDF files don’t have to be the same.</p>
<p>My_Data.nc</p>
<p>My_Data.cdf</p>
<p><strong>&gt; ncdump.exe My_Data.nc &gt; My_Data.cdf</strong></p>
<p><strong>&gt; ncgen.exe -b My_Data.cdf</strong></p>
<p><img src="media/image16.png" style="width:5.68056in;height:2.68056in"></p>
<p>Once you converted the NC file into CDF, you can open it using a text editor. Here is an example of an output.nc file (comments after ## are added here for explanation):</p>
<table class="caption-top">
<thead>
<tr class="header">
<th><p>netcdf example { <em>## name of the file</em></p>
<p><em>## header section of the file – describes file contents and dimensions</em></p>
<p><strong>dimensions:</strong></p>
<p>t = UNLIMITED ; // (111 currently) <em>## number of time steps</em></p>
<p>b = 29 ; <em>## number of boxes</em></p>
<p>z = 9 ; <em>## number of layers</em></p>
<p>icenz=2; <em>## OPTIONAL: number of ice layers</em></p>
<p><em>## the</em> <a href="https://confluence.csiro.au/display/Atlantis/Changed+to+prm+files"><em>icenz</em></a> <em>attribute <a href="https://confluence.csiro.au/display/Atlantis/Ice+in+Atlantis">activates the ice model</a></em></p>
<p><strong>variables:</strong> <em>## start listing variable descriptions</em></p>
<p>double t(t) ; <em>## double precision 1D variable - time</em></p>
<p>t:units = "seconds since 2005-01-01 00:00:00 +10" ; <em>## start time of the simulation: <strong>time stamp</strong></em></p>
<p>double volume(t, b, z) ; <em>## 3-dimens. variable: volume (t, b, z)</em></p>
<p>volume:bmtype = "phys" ; <em>## description of Physical variables</em></p>
<p>volume:units = "m3" ;</p>
<p>volume:long_name = "Volume" ;</p>
<p>…</p>
<p>double Det_Si(t, b, z) ; <em>## description of Tracer variables</em></p>
<p>Det_Si:bmtype = "tracer" ;</p>
<p>Det_Si:units = "mg Si m-3" ;</p>
<p>Det_Si:long_name = "Detrital Silica" ;</p>
<p>Det_Si:dtype = 0 ;</p>
<p>Det_Si:sumtype = 1 ;</p>
<p>Det_Si:inwc = 1 ;</p>
<p>Det_Si:insed = 1 ;</p>
<p>Det_Si:decay = 0. ;</p>
<p>Det_Si:dissol = 0 ;</p>
<p>Det_Si:partic = 1 ;</p>
<p>Det_Si:passive = 1 ;</p>
<p>Det_Si:svel = -2.894e-005 ;</p>
<p>Det_Si:xvel = 0. ;</p>
<p>Det_Si:psize = 1.e-005 ;</p>
<p>Det_Si:b_dens = 1000000000. ;</p>
<p>Det_Si:i_conc = 200000000. ;</p>
<p>Det_Si:f_conc = 200000000. ;</p>
<p>…</p>
<p>double Filter_Soft_N(t, b) ; <em>## description of Epibenthic variables</em></p>
<p>Filter_Soft_N:bmtype = "epibenthos" ;</p>
<p>Filter_Soft_N:units = "mg N m-2" ;</p>
<p>Filter_Soft_N:long_name = "Soft substrate filter feeders Nitrogen" ;</p>
<p>Filter_Soft_N:dtype = 0 ;</p>
<p>Filter_Soft_N:sumtype = 1 ;</p>
<p>…</p>
<p><strong>// global attributes:</strong> <em>##global attributes or variables</em></p>
<p>:title = "Baltic" ;</p>
<p>:geometry = "Baltic_aea_v2BGM" ;</p>
<p>:parameters = "atlantismain2.exe -i init_Baltic.nc 0 -o BalticClimate1.nc -s BalticClimate1TOT.nc -g BalticClimate1PROD.nc -c BalticClimate1TOTCATCH.nc -d BalticClimate1CATCH.nc -r Baltic_run.prm -f Baltic_force2015.prm -b Baltic_biol_Climate.prm -h -p Baltic_physics.prm"; <em>##details on BAT and other outputs</em></p>
<p>:wcnz = 8 ; <em>## number of water column layers</em></p>
<p>:sednz = 1 ; <em>## number of sediment layers</em></p>
<p>## data section of the file contains a data entry for each variable declared in the header section</p>
<p><strong>data:</strong> <em>## start of the data for each variable</em></p>
<p>t = 0, 7862400, 15724800, 23587200, 31449600, 39312000, 47174400, <em>## time steps of the simulation</em></p>
<p>55036800, 62899200, 70761600, 78624000, 86486400, 94348800, …</p>
<p>volume = <em>## variable values per layer, box, time</em></p>
<p>0, 0, 0, 0, 1762842878.80397, 8664747499.65088, 2166186874.91272,</p>
<p>2166186874.91272, 216618687.491272,</p>
<p>0, 0, 0, 0, 0, 15949302157.943, 27451466709.024, 27451466709.024,</p>
<p>2745146670.9024, …</p>
<p>… <em>## continued until all variables are listed</em></p>
<p>}</p></th>
</tr>
</thead>

</table>
</section>
<section id="introduction-to-atlantis-variables" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-atlantis-variables"><strong>2.8. Introduction to Atlantis variables</strong></h2>
<p>There are three kinds of obligatory and two kinds of optional variables used in Atlantis. Variable types are defined by the bmtype parameter:</p>
<p>1) “phys” - physical properties of the model</p>
<p>2) “tracer” – three-dimensional dynamic variables (either in the water column or the sediments) of the model domain</p>
<p>3) “epibenthos” – two-dimensional dynamic benthic variables</p>
<p>4) <a href="https://confluence.csiro.au/display/Atlantis/Changed+to+Initial+Conditions+NetCDF+file">“icetracer”</a> – a variable that exists in ice layers (if the model explicitly includes ice)</p>
<p>5) “<a href="https://confluence.csiro.au/display/Atlantis/Land+in+Atlantis">terrestrial</a>” – tracers used to identify land variables (if the model explicitly includes land)</p>
<p>Each variable declaration includes the expected numerical precision. A few variables (e.g.&nbsp;numlayers) are marked as short, which means they are expecting integer input variables, but most variables are doubles, which indicates that they are a double precision floating point number format (a computer way saying this is a real number not simply an integer). The precision identifier is followed by the variable name and the expected dimensions. Variables can be one dimensional (time), two dimensional (time, box) or three dimensional (time, box, layer). It is important to make sure the data entered has this many dimensions (with no omissions) as Atlantis assumes the dimensions are fully filled when it loads the data.</p>
<p>Next, the file lists the characteristics of the variables. All variables have four general parameters: units, long_name, dtype, sumtype. Units and long_name are only needed for the user and interpretation of results; they are entered in inverted commas ” ” as they will be loaded as strings of text by Atlantis.</p>
<p>The parameters dtype and sumtype are flags whose value determines where the output of the variable value is to be written.</p>
<p>The dtype describes the information that will be written to the output files. It can have four values:</p>
<p>0: Standard snapshots, sent to the base <em>out.nc</em> output files and summarised in 2D in <em>outTOT.nc</em></p>
<p>1: Fisheries total values, written to <em>fisheresTOT.nc</em> files when the fisheries submodel is active</p>
<p>2: Ecological diagnostics, sent to diagnostic <em>PROD.nc</em> files (production, consumption etc)</p>
<p>3: Detailed fisheries information, typically used for tracers in the dynamic fisheries, sent to base <em>fisheries_out.nc</em> file</p>
<p>The sumtype parameter can have two values:</p>
<p>0: indicates that data is written in the 3D format (per layer per box per time step) in the main <em>out.nc</em> file and given in detail</p>
<p>1: indicates that, in addition to the 3D output given in the main <em>out.nc</em> file, summary (e.g.&nbsp;total value per box integrated over all layers) is also written to the <em>outTOT.nc</em> file</p>
<p>The term “<strong>tracer</strong>” will be used often throughout the manual. Most of the variables belong to this category. They include temperature, salinity, oxygen, nutrients (NO3, NH3, organic nitrogen), bacteria, pelagic organisms and description of age structured groups. Most tracers, like bacteria_N, cod1_numbers are dynamic, which means they participate in the processes and change through time. The <em>initial_conditions.nc</em> file includes some important characteristics of these tracers (Table 4). Other tracers are in fact processes, such as Nitrification, Denitrification, Light adaptation, Sediment Porosity and others. They are initiated as tracers in order to create arrays for them, so Atlantis has a dedicated place to write the output for them.</p>
<p><span id="_Toc526762756" class="anchor"></span>Table 4. Parameters used to describe characteristics of Atlantis variables in the <em>initial_conditions.nc</em> file. These parameters are read in by the <em>readBMTracerInfo()</em> in <u>attracerIO.c</u></p>
<table class="caption-top table">
<colgroup>
<col style="width: 3%">
<col style="width: 37%">
<col style="width: 59%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th><strong>What it means</strong></th>
<th><strong>Where is it used</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>inwc</td>
<td>Tracer present in water column<sup>1</sup></td>
<td><p>Used in most routines that deal with processes in the water column. If a tracer is not present in water column in will be skipped in these routines.</p>
<p>This is only important for tracers that are used by diffusion, decay, deposition, settling or injection routines (nutrients, sediments, plankton). They are not important for fully age structured groups</p></td>
</tr>
<tr class="even">
<td>insed</td>
<td><p>Tracer present in sediments<sup>1</sup></p>
<p><sup>1</sup>A tracer can be present both in water column <strong>AND</strong> in sediments</p></td>
<td>Used in most routines that deal with sediment processes. For example, if a tracer is not allowed in the sediments the deposition routine will not deposit it in the sediment, but will leave it in the bottom water layer</td>
</tr>
<tr class="odd">
<td>dissol</td>
<td>Tracer dissolved in water <sup>2</sup></td>
<td>Used in routines that deal with diffusion and advection processes</td>
</tr>
<tr class="even">
<td>partic</td>
<td><p>Tracer is particulate<sup>2</sup></p>
<p><sup>2</sup>A tracer can only be “dissolved” OR “particulate”</p></td>
<td><p>Used in routines that deal with particulate tracers.</p>
<p>It is recommended to put this value to 1 for all tracers that are not dissolved (which naturally includes biological group tracers)</p></td>
</tr>
<tr class="odd">
<td>passive</td>
<td>Tracer can be passively advected</td>
<td><p>Important for particulate tracers. Only passive particulate tracers are advected (moved by water between cells).</p>
<p>Anything that is particulate and passive also require – particle size, sedimentation velocity (svel), and extra settling velocity (xvel)</p></td>
</tr>
<tr class="even">
<td>decay</td>
<td><p>exponent in the burial or removal rate per second</p>
<p>Note, this is not an actual decomposition into other nutrients (like decay of organic nitrogen into NO3), but a complete removal of the variable from the system, such as burial in the sediments</p></td>
<td><p>Used in the Physics submodel to calculate decay rates</p>
<p>This parameter is very important and will determine <strong>the rate of tracer removal</strong> from the system. It is typically set to 0 for most tracers)</p></td>
</tr>
<tr class="odd">
<td>svel</td>
<td>Sedimentation velocity, m/second</td>
<td>Used in the Physics submodel to calculate sedimentation rate of particulate tracers</td>
</tr>
<tr class="even">
<td>xvel</td>
<td>Extra settling velocity - due to migration of nutrient limitation. This parameter was inherited from PPIB and ERSEM models (see below) and is typically set to 0</td>
<td>Used in the Physics submodel to calculate sedimentation rate of particulate tracers</td>
</tr>
<tr class="odd">
<td>psize</td>
<td><p>Particle size, in meters</p>
<p>Particle size will determine deposition of particulate matter in sediments</p></td>
<td>Used in the Physics submodel to calculate sedimentation and resuspension rate</td>
</tr>
<tr class="even">
<td>b_dens</td>
<td>Particle bulk density (mg*m<sup>-3</sup>)</td>
<td>Used in the Physics submodel to calculate deposition and porosity. Used in <em>deposition()</em> and in calculating sediment density. These parameters in the real world dictate particle movements in real water, but in Atlantis default values would do, because sediment properties are not modelled in such detail.</td>
</tr>
<tr class="odd">
<td>i_conc</td>
<td>Particle initial concentration in the deposits</td>
<td>Used in the Physics submodel to calculate deposition and porosity. It is used in <em>deposition()</em> routine only</td>
</tr>
<tr class="even">
<td>f_conc</td>
<td>Particle final concentration in the deposits, after compaction</td>
<td><strong>This was only used in old models. Current code does not read this in.</strong></td>
</tr>
<tr class="odd">
<td>FillValue</td>
<td>Default value to use when automatically filling empty cells in the initial_conditions.nc arrays</td>
<td>This is often used when tracer the initial concentration in most cells is identical</td>
</tr>
</tbody>
</table>
<p><span id="chapter29" class="anchor"></span></p>
</section>
<section id="tools-and-packages-to-view-and-analyse-atlantis-input-and-output-files" class="level2">
<h2 class="anchored" data-anchor-id="tools-and-packages-to-view-and-analyse-atlantis-input-and-output-files"><strong>2.9 Tools and packages to view and analyse Atlantis input and output files</strong></h2>
<p>The Atlantis community has developed a number of different tools to view and analyse these outputs. The main tools used currently include:</p>
<p>1) An R package “atlantistools” contributed by Alexander Keth, available from https://github.com/alketh/atlantistools</p>
<p>2) A number of excel template files, matlab and R scripts developed by different users and available on <a href="https://confluence.csiro.au/display/Atlantis/Atlantis+Helper+Tools">Atlantis wiki</a></p>
<p>3) An R package “rlantis”, available on <a href="https://github.com/mareframe/rlantis" class="uri">https://github.com/mareframe/rlantis</a></p>
<p>4) netcdf viewing packages <a href="https://confluence.csiro.au/display/Atlantis/How+to+view">Olive and Dive</a> useful for spatial plotting of variables in the NC files</p>
<p>5) R based Shiny application “shinyrAtlantis” contributed by Shane Richards and available on <a href="https://github.com/shanearichards/shinyrAtlantis" class="uri">https://github.com/shanearichards/shinyrAtlantis</a>. This package is very useful for visualising the <em>initial_conditions.nc</em> and parameter files in a spatial context.</p>
<p>A number of other packages and tools are in different stages of development. So stay tuned with updates by joining the <a href="https://groups.google.com/forum/#!forum/atlantis-ecosystem-model">Atlantis google group</a> and regularly checking for updates on the Atlantis wiki. If you have a tool you think others would benefit from please feel free to share it via the wiki or the Atlantis google group.</p>
</section>
<section id="troubleshooting-on-installation-and-running" class="level2">
<h2 class="anchored" data-anchor-id="troubleshooting-on-installation-and-running"><strong>2.10. Troubleshooting on installation and running</strong></h2>
<p>Don’t be disappointed if your first run attempt fails. This is very common! Below is a list of some common errors and more are available on the <a href="https://confluence.csiro.au/display/Atlantis/Common+Windows+Build+Errors">Atlantis wiki</a>:</p>
<p><strong>1. Missing DLL files.</strong> This is one of the most common problems for Windows users. Make sure you have installed the right version of the NetCDF library and updated the path as described on the wiki. If issues still persist, you might need to remove and reinstall the NetCDF library.</p>
<p><img src="media/image17.tmp" style="width:4.84221in;height:3.152in"></p>
<p><strong>2. “Can’t open input data file”.</strong> Make sure the paths specified in the <em>force.prm</em> file are correct.</p>
<p>In the case below there was a typo in the path, the ‘inputs’ directory folder was misspelled</p>
<p>hd0.name ../inputs<strong><u>s</u></strong>/forcisets/Baltic_2005_hydro_22May2014.nc</p>
<p>Once this is fixed into</p>
<p>hd0.name ../inputs/forcisets/Baltic_2005_hydro_22May2014.nc</p>
<p>the run went smoothly</p>
<p><img src="media/image18.tmp" style="width:5.09247in;height:3.28in"></p>
<p><strong>3. Failed to find a parameter.</strong> If some of the required parameters in the PRM files are missing Atlantis will quit and give an error message. In the case below Atlantis could not find a parameter FCD_mL. This happens when mistakes were made in formatting parameter files (e.g.&nbsp;if you used excel to create your file check to see if the PRM file contains ” ” around a parameter name, if does remove them and just leave the name) or when new obligatory parameters were added during the code update to account for new functionality (and you have updated the code on your computer)</p>
<p>Keep an eye on the Atlantis wiki <a href="https://confluence.csiro.au/pages/viewrecentblogposts.action?key=Atlantis">news blog</a> for information on modifications to the code and any new required parameters. To find the missing parameters search the Atlantis wiki for the parameter name to see what is expected.</p>
<p><img src="media/image19.tmp" style="width:5.184in;height:3.35045in"></p>
<p><strong>4. Atlantis crashes with a specific error message on physics, biology or other processes.</strong></p>
<p>Atlantis code has inbuilt checks that will cause the program to quit if things go wrong. This can happen if biomasses of some lower trophic groups go to very low levels, or volumes of cells change too much. These messages cannot all be included here, but the best way to understand them is to search for keywords in the message in the code itself. This approach is also useful in understanding where different parameters are used in the code.</p>
<p>To search for a specific string in the entire code, select Quick Find (Ctrl+F) from the Edit menu, and enter the string you want to find. Make sure you search in the “Entire Solution” (selected in the “Look in:” menu) rather than the current document or routine. Also make sure you enter the text accurately.</p>
<p>When you search for an error message only enter general text, e.g.&nbsp;“ERROR: Volume of cell box”, as in the example shown above. Do not enter specific numbers from the error message, as they are not present in the code (they are specific to that one simulation only). For example, the crash message might say</p>
<p>ERROR: Volume of cell box 5: layer 1 is zero…”</p>
<p>However the message built in the code actually looks like this:</p>
<p>ERROR: Volume of cell box %d: layer %d is zero</p>
<p>where %d values will be replaced by specific numbers.</p>
<p><img src="media/image20.png" style="width:6.79097in;height:4.90347in"></p>
<p>Finding the routine that leads to the error message may not immediately answer your questions, but it might give ideas about where things went wrong and which parameters might have to change (look at the parameters used in this routine). It is not necessarily straightforward and easy, but as you get used to searching through the code and understand it better, things will slowly start making sense.</p>
<p>A document compiling error messages is available on Google Doc file (available on March 20, 2016):</p>
<p><a href="https://docs.google.com/document/d/1B3X6_Y29gZxtKzjZY2oyylAJBxVtYXXu72pVbwv6mWw/edit" class="uri">https://docs.google.com/document/d/1B3X6_Y29gZxtKzjZY2oyylAJBxVtYXXu72pVbwv6mWw/edit</a></p>
<p>Please check this document for further information and to contribute to it by posting error messages you get.</p>
<p>****</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We do endeavour to update things for new naming conventions, but we also find it is better to err on the side of caution.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>