<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Atlantis Documentation – PRIMARY PRODUCTION PARAMETERS</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Atlantis Documentation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-user-guides" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">User Guides</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-user-guides">    
        <li>
    <a class="dropdown-item" href="../../../user_guides/quarto_site/part1/index.html">
 <span class="dropdown-text">Part I - Atlantis User Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../user_guides/quarto_site/part2/index.html">
 <span class="dropdown-text">Part II - [Coming Soon]</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../confluence/index.html"> 
<span class="menu-text">Confluence Wiki</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../resources/index.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../user_guides/quarto_site/part1/10-primary-producer-processes.html">9. Primary Producer Processes</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/01-foreward.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">0. Foreword</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/02-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/03-installation-and-running.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. Installation and Running</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/04-geometry-of-the-model-domain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Geometry of the Model Domain</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/05-hydrodynamic-salinity-and-temperature-forcing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Hydrodynamic, Salinity and Temperature Forcing Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/06-the-physics-submodel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. The Physics Submodel</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/07-definitions-of-functional-groups.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Definitions of Functional Groups</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/08-run-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. Run Parameters</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/09-force-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Force Parameters</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/10-primary-producer-processes.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">9. Primary Producer Processes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/11-consumer-processes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. Consumer Processes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/12-distribution-and-movement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. Distribution and Movement</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/13-processes-in-bacterial-and-inanimate-pools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. Processes in Bacterial and Inanimate Pools</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/14-influence-of-environmental-factors-on-ecological-p.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. Influence of Environmental Factors on Ecological Processes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/15-final-overview-of-ecology-routines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. Final Overview of Ecology Routines</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/16-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../user_guides/quarto_site/part1/17-appendix-1-tips-for-calibrating-biological-model-n.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix 1: Tips for Calibrating Biological Model</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#fluxes-in-primary-producers" id="toc-fluxes-in-primary-producers" class="nav-link active" data-scroll-target="#fluxes-in-primary-producers"><strong>9.1. Fluxes in primary producers</strong></a></li>
  <li><a href="#primary-producer-growth" id="toc-primary-producer-growth" class="nav-link" data-scroll-target="#primary-producer-growth"><strong>9.2. Primary producer growth</strong></a>
  <ul>
  <li><a href="#primary-producer-nutrient-limitation" id="toc-primary-producer-nutrient-limitation" class="nav-link" data-scroll-target="#primary-producer-nutrient-limitation"><strong><em>9.2.1. Primary producer nutrient limitation</em></strong></a></li>
  <li><a href="#primary-producer-light-limitation" id="toc-primary-producer-light-limitation" class="nav-link" data-scroll-target="#primary-producer-light-limitation"><strong><em>9.2.2. Primary producer light limitation</em></strong></a></li>
  <li><a href="#primary-macrophyte-producer-space-limitation" id="toc-primary-macrophyte-producer-space-limitation" class="nav-link" data-scroll-target="#primary-macrophyte-producer-space-limitation"><strong><em>9.2.3. Primary macrophyte producer space limitation</em></strong></a></li>
  <li><a href="#effect-of-eddies-on-primary-production" id="toc-effect-of-eddies-on-primary-production" class="nav-link" data-scroll-target="#effect-of-eddies-on-primary-production"><strong><em>9.2.4 Effect of eddies on primary production</em></strong></a></li>
  </ul></li>
  <li><a href="#primary-producer-mortality" id="toc-primary-producer-mortality" class="nav-link" data-scroll-target="#primary-producer-mortality"><strong>9.3. Primary producer mortality</strong></a></li>
  <li><a href="#encystment-of-primary-producers" id="toc-encystment-of-primary-producers" class="nav-link" data-scroll-target="#encystment-of-primary-producers"><strong>9.4. Encystment of primary producers</strong></a></li>
  <li><a href="#effect-of-temperature-and-salinity-on-primary-production" id="toc-effect-of-temperature-and-salinity-on-primary-production" class="nav-link" data-scroll-target="#effect-of-temperature-and-salinity-on-primary-production"><strong>9.5. Effect of temperature and salinity on primary production</strong></a></li>
  <li><a href="#growth-of-mixotrophic-primary-producers" id="toc-growth-of-mixotrophic-primary-producers" class="nav-link" data-scroll-target="#growth-of-mixotrophic-primary-producers"><strong>9.6. Growth of mixotrophic primary producers</strong></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">PRIMARY PRODUCTION PARAMETERS</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The main Atlantis model has six different types of primary producers, including two sizes of phytoplankton (large phytoplankton LG_PHY and small phytoplankton SM_PHY), mixotrohic dinoflagellates (DINOFLAG), microphytobenthos (MICROPHTYBENTHOS) and two epibenthic groups (seagrasses SEAGRASS and other phytobenthos PHYTOBEN). In models including ice, specific ice primary producers are modelled. Simialrly in models that dynamically represent land, the user can define terrestrial vegetation (primary producer) groups, which are restricted to land (e.g.&nbsp;MANGROVE, MARSH, with crops and agriculture also available as in industry if the land use model option is used). The description below will focus on the main model only.</p>
<section id="fluxes-in-primary-producers" class="level2">
<h2 class="anchored" data-anchor-id="fluxes-in-primary-producers"><strong>9.1. Fluxes in primary producers</strong></h2>
<p>In primary producer pools the flux is determined by growth (<em>G<sub>PP</sub></em>), natural mortality (<em>M<sub>PP</sub></em>) and grazing (predation) (<em>Gr<sub>PP,i</sub></em>). In addition, there is an optional encystment at certain times of the year or when temperatures (<em>Ec<sub>out</sub></em>) reach a certain trigger level. Transfer back from cysts occurs when conditions are suitable (<em>Ec<sub>in</sub></em>).</p>
<p>Four types of primary producer groups are tracked separately in both the water column and sediments (SM_PHY, LG_PHY, DINOFLAG, MICROPHTYBENTHOS). Two groups are restricted to the epibenthic layer (PHYTOBEN, SEAGRASS). The general flux equation is</p>
<p><span class="math display">\[\frac{d(PP)}{dt} = G_{PP} - M_{PP} - \sum_{i = predators}^{}{Gr_{PP,i}} - Ec_{out} + Ec_{in}\]</span></p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>NOTE!</strong> Not all processes are executed in all layers.</p>
<p><strong>Primary producer GroupType processes in water column, sediments and epibenthos</strong></p>
<p>For SM_PHY, LG_PHY, DINOFLAG:</p>
<p><strong>In the water column</strong>: the processes executed are growth (primary production) and mortality due to lysis and grazing. <strong>In the sediments</strong>: there is no primary production (only mixotrophic production in DINOFLAG), no lysis mortality and no grazing, only linear mortality.</p>
<p>For MICROPHTYBENTHOS: <strong>In the water column and sediments</strong>: growth (primary production) and mortality due to grazing are carried out in both locations, with mortality due to lysis in water column or linear mortality in sediments.</p>
<p>For SEAGRASS and PHYTOBEN: <strong>In epibenthic layer</strong>: growth (primary production), linear and extra mortality and mortality due to grazing are all executed.</p>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Role and origin of microphytobenthos in Atlantis</strong></p>
<p>Most ecosystem models do not explicitly model microphytobenthos, which consists of small epibenthic primary producers. The Port Philip Bay Integrated Model (PPBIM) (Muray and Parslow 1997), which is used as a basis for simulating lower trophic level dynamics in Atlantis, included microphytobenthos, because it was well studied in the Port Phillip Bay and its production was shown to be significant. Other estuarine models also use microphytobenthos given its important role in those kinds of ecosystems. However, for the majority of coastal Atlantis models the group is not used due to the limited amount of data available for parameterisation and the deeper water depths, where it plays a less important role.</p>
</div>
</div>
</section>
<section id="primary-producer-growth" class="level2">
<h2 class="anchored" data-anchor-id="primary-producer-growth"><strong>9.2. Primary producer growth</strong></h2>
<p>The equations and processes governing primary production in Atlantis have been adopted from the PPBIM model of <a href="https://confluence.csiro.au/display/Atlantis/Useful+Reading?preview=/43155482/341447378/Link_et_al_2011_NEUS_tech_memo.pdf">Murray and Parslow (1997)</a>. Primary production processes are executed by <em>Primary_Production()</em> routine in <strong>atprocess.c</strong></p>
<p>Growth of a primary producer <em>pp</em> is determined by <strong>multiplying</strong> the biomass of <em>pp</em> by the maximum specific growth rate (<em>mum</em>) and by three additional potentially limiting factors:</p>
<ol type="1">
<li>nutrient limitation factor</li>
<li>light limitation factor</li>
<li>space limitation factor for benthic macrophytes</li>
<li>optional eddy scalar, representing enhancement of primary production by eddies</li>
<li>optional pH scalar, accounting for possible effects of acidification on primary production</li>
</ol>
<p><span class="math display">\[G_{pp} = mum \cdot B_{PP} \cdot \delta_{light} \cdot \delta_{nutrient} \cdot \delta_{space} \cdot \delta_{eddy} \cdot pHscalar\]</span></p>
<p>The <em>mum</em> parameter defines the maximum growth rate per day (mgN day<sup>-1</sup>).</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Multiplicative model for nutrient and light co-limitation (from Murray and Parslow, 1997, page 26):</strong></p>
<p>“Multiplicative models for nutrient and light co-limitation have been widely used (Fasham et al.&nbsp;1990). A potential problem with multiplicative interactions involving several factors is that predictive growth rates become very low when each factor is moderately limiting. An alternative, Liebig's law of the minimum (ie. multiply mum by the smallest factor) is more often applied to interactions among multiple nutrients.”</p>
<p>Atlantis has different options to design limitation by different nutrients (N, Si and P if phosphorus is tracked), set by the flagnut parameter, with choices of multiplicative or Leibig (minimum nutrient) limitation. However, this does not apply to combined limitation by nutrient, light and space, where simple multiplication is used. The quote above suggests caution when applying multiple limitations on growth, and careful assessment of whether the multiple impacts do not lead to overly constraining limitation.</p>
</div>
</div>
<section id="primary-producer-nutrient-limitation" class="level3">
<h3 class="anchored" data-anchor-id="primary-producer-nutrient-limitation"><strong><em>9.2.1. Primary producer nutrient limitation</em></strong></h3>
<p>The <strong>nutrient limitation</strong> <em>δ<sub>nutrient&nbsp;</sub></em>scalar in case of limitation based on N only is calculated as</p>
<p><span class="math display">\[\delta_{nutrient} = \frac{DIN}{KN + DIN}\]</span></p>
<p>where <strong>DIN = NH3+NO3</strong> (ammonia and nitrate concentration) and <em>KN</em> is the half saturation constant of nutrient uptake (KN_XXX) in mgN m<sup>-3</sup></p>
<p>Nutrient limitation is calculated by the <em>Nutrient_Lim()</em> routine in <strong>atprocess.c</strong></p>
<p>When phytoplankton is limited by multiple nutrients, such as N and Si in the case of diatoms, the choice of limitation equation is set by the flagnut parameter. This parameter calls three types of nutrient limitation options – Leibig, multicative, and the ERSEM WQI based option. Only the first two options have been more widely used, whereas the third version has been implemented only for testing purposes. The nutrient limitation scalar for the three options is calculated as:</p>
<p><span class="math display">\[\delta_{nutrient} = \min\left( \frac{DIN}{KN + DIN},\frac{Si}{KS + Si} \right)\ \ \ \ \ \ \ \ \ \ \ \ \ if\ Leibig\ limitation\ is\ used\ (flagnut = 0)\]</span></p>
<p><span class="math display">\[\delta_{nutrient} = \sqrt{\frac{DIN}{KN + DIN} \cdot \frac{Si}{KS + Si}}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ multicative\ limitation\ is\ used\ (flagnut = 1)\]</span></p>
<p><span class="math display">\[\delta_{nutrient} = \frac{2}{\left( \frac{DIN}{KN + DIN} + \frac{Si}{KS + Si} \right)}\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ WQI\ \ limitation\ is\ used\ (flagnut = 2)\]</span></p>
<p>For illustration, assuming a hypothetical case of DIN and Si concentrations of 100 mg m<sup>-3</sup> and half saturation values for N and Si at 50 mg m<sup>-3</sup> and 20 mg m<sup>-3</sup> the three limitation cases would results in scalars of 0.67, 0.75 and 1.41.</p>
<p>Atlantis has an optional nutrient limitation for one additional tracer of micronutrients (currently used for iron). This option is set when flagmicro=1. If micronutrient limitation is used, half-saturation constants (KF_XXX) should be provided for all primary producer groups. Limitation by additional nutrients will be done according to the flagnut option described above.</p>
<p>In models that track P and C (TrackAtomicRatio =1 in <em>run.prm</em> file) primary production will also be limited by P and C. Further details are available on the <a href="https://confluence.csiro.au/display/Atlantis/2013/04/23/New+Phosphorus+tracking">wiki</a>.</p>
</section>
<section id="primary-producer-light-limitation" class="level3">
<h3 class="anchored" data-anchor-id="primary-producer-light-limitation"><strong><em>9.2.2. Primary producer light limitation</em></strong></h3>
<p>Photosynthesis in the model is potentially light-limited and the available suitable light (W m<sup>-2</sup>) – the photosytenthically active radiation (PAR) - in the water column and at the sediment surface is modelled explicitly. The <strong>light limitation</strong> <em>δ<sub>light&nbsp;</sub></em>factor is calculated in <em>Light_Lim()</em> in <strong>atproces.c</strong> as:</p>
<p><span class="math display">\[\delta_{light} = \min\left( \frac{IRR}{KI},1 \right)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ light\ adaptation\ is\ not\ used\ (flaglight = 0)\]</span></p>
<p>where <em>IRR</em> is the amount of light available for the photosynthesis and <em>KI</em> is the light saturation coefficient (KI_XXX) in W m<sup>-2</sup>.</p>
<p>Atlantis allows for <strong>light adaptation</strong> of primary producers to be represented, which is intended to capture their ability to rapidly adapt to different light conditions. It is used when flaglight = 1 and requires four additional parameters (KIOP_min, KIOP_shift, KI_avail, K_addepth), used to calculate <em>optIRR</em> in <em>Box_Light_Process()</em> in <strong><u>atbiophysics.c</u></strong></p>
<p>If light adaptation is used the light limitation is calculated as</p>
<p><span class="math display">\[\delta_{light} = \min\left( \frac{IRR}{KI + optIRR},1 \right)\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ if\ light\ adaptation\ is\ used\ (flaglight = 1)\]</span></p>
<p>The amount of light falling on the surface of the top layer is either provided through external time series or calculated in Atlantis depending on the lim_sun_hours setting (described in chapter 5, Physics).</p>
<p>The <strong>light attenuation</strong> <em>Kd</em> through the water column (described in Fulton 2001) defines the availability of light to primary producers at different depths and is calculated as</p>
<p><span class="math display">\[Kd = k_{w} + k_{IS} + k_{PN} \cdot \sum_{i = phytopl}^{}{B_{i} + k_{DON} \cdot B_{DON} + k_{DL} \cdot \left( B_{DL} + B_{DR} \right) + k_{SED} \cdot B_{SED}}\]</span></p>
<p>The equation shows that light attenuation is simply defined by the background blue water light absorption coefficient (<em>k<sub>w</sub></em>), additional light absorption due to tanins and other non-biological particulate matter that is important in coastal areas (set in <em>k<sub>IS</sub></em>), and concentration or biomass of light attenuating organisms (plankton) or substances (DON, detrituts, sediments) multiplied by the corresponding light attenuation coefficient. The attenuation is caused by:</p>
<ol type="1">
<li>background light absorption by water itself (<em>k<sub>w</sub></em>) – used in the PPBIM model.</li>
<li>additional background light absorption by water due to tanins and other non-biological particulate matter that is important in coastal areas (set in <em>k<sub>IS</sub></em>). Different coefficients (k_w_shallow and k_w_deep) are used for coastal and oceanic water. This second term of light absorption was not used in PPBIM but was taken from ERSEM</li>
<li>phytoplankton, with k_PN defining coefficient of light absorption by particulate matter, such as phytoplankton</li>
<li>dissolved organic nitrogen and the relevant coefficient k_DON</li>
<li>labile and refractory detritus and the coefficient k_DL</li>
<li>light absorption by suspended sediment k_SED, used only if the model is estuary (flagIsEstuary=1)</li>
</ol>
</section>
<section id="primary-macrophyte-producer-space-limitation" class="level3">
<h3 class="anchored" data-anchor-id="primary-macrophyte-producer-space-limitation"><strong><em>9.2.3. Primary macrophyte producer space limitation</em></strong></h3>
<p>Space limitation is only applied to epibenthic primary producers, defined by PHYTOBEN or SEAGRASS</p>
<p>The <strong>space limitation</strong> <em>δ<sub>space&nbsp;</sub></em>factor is calculated as</p>
<p><span class="math display">\[\delta_{space} = \frac{B_{PP}}{SPmax \cdot P_{area}}\]</span></p>
<p>where <em>SPmax</em> is the coefficient setting maximum biomass of the epibenthic primary producer (XXmax) in mgN m<sup>-2</sup> and <em>P<sub>area&nbsp;</sub></em>is the proportion of the cell covered with suitable habitat scaled by the habitat degradation scalar (if used). Space limitation is activated using flagXXXlim.</p>
</section>
<section id="effect-of-eddies-on-primary-production" class="level3">
<h3 class="anchored" data-anchor-id="effect-of-eddies-on-primary-production"><strong><em>9.2.4 Effect of eddies on primary production</em></strong></h3>
<p>The effect of eddies, or the <strong>eddy scalar</strong> <em>δ<sub>eddy</sub></em>, on primary production is modelled by simple scaling (multiplication) using the user defined eddy_scale parameter. This dimensionless parameters is multiplied by the eddy strength in a given box to obtain <em>δ<sub>eddy</sub></em></p>
<p><span class="math display">\[\delta_{eddy} = {eddy}_{scale} \cdot {eddy}_{strength}\]</span></p>
<p>Eddy strengths for each box and each quarter are set in the <em>physics.prm</em> file (see Chapter 5.2, section III).</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Effect of eddies on primary production</strong></p>
<p>There is good evidence to suggest that the presence of eddies significantly enhances primary production through vertical water column mixing creating spatial and seasonal variation. There are two ways to add this variation in Atlantis and users are encouraged to make use of these parameters.</p>
<p>First, the effects of eddies on vertical mixing alone can be included through the parameters in the <em>physics.prm</em> (eddy_vertmix, eddy_S1 to eddy_S2, eddy_mixscale – see chapter 5.2, section III). This should increase vertical mixing in the water column and bring extra nutrients to the surface.</p>
<p>Second, the user can add an extra scalar <em>δ<sub>eddy&nbsp;</sub></em>on primary production through the eddy_scale parameter in the <em>biology.prm</em> file. This scalar will take the eddy values and re-scale the primary production calculated for the available amount of light and nutrients based on eddy strength. The second approach assumes that additional nutrients are implicitly supplied through eddies, increasing primary production (these nutrients do not appear in the tracer values but represent just an assumed increase). This <em>ad hoc</em> approach can be taken if the model fails to accurately reflect spatial and seasonal variation in primary production, but the explicit dynamics of nutrient turnover is not resolved accurately enough to enhance primary production sufficiently through nutrient mixing alone. It is not recommended for models that focus on nutrient dynamics and lower trophic levels, but might be useful for models that focus on the dynamics at higher trophic levels and socio-economic aspects.</p>
</div>
</div>
</section>
</section>
<section id="primary-producer-mortality" class="level2">
<h2 class="anchored" data-anchor-id="primary-producer-mortality"><strong>9.3. Primary producer mortality</strong></h2>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Primary producers in water column, sediments and epibenthos</strong></p>
<p>Primary producer processes are handled differently depending on whether they are in the water column (WC), sediments (SED) or epibenthic layer (EPI).</p>
<p>Four primary producer groups are tracked both in the WC and SED (SM_PHY, LG_PHY, DINOFLAG, MICROPHTYBENTHOS). Two groups are restricted to the epibenthic layer (PHYTOBEN, SEAGRASS)</p>
<p><strong>In WC:</strong> phytoplankton groups (SM_PHY, LG_PHY) can only grow (photosynthesise) when they are in the WC. MICROPHTYBENTHOS can grow both in the WC and in SED; for photosynthesis in the SED they use light conditions at the top of the sediment. DINOFLAG do not photosynthesis in the SED, but they can have mixotrophic feeding. Mortality expressed depends on whether it is in the WC and SED: primary producers are affected by linear mortality (mL_XXX) and optional acidification mortality in both locations, but phytoplankton (SM_PHY and LG_PHY) only suffer lysis (KLYS_XXX) in the WC. DINOFLAG and MICROPHYTOBENTHOS have all mortality terms in both locations. Both lysis and other mortality terms are separately scaled by the <strong><em>external forced optional mortality scalar</em></strong>. All mortality products are transferred into the WC or SED labile detritus pools respectively.</p>
<p><strong>In EPI</strong>: epibenthic primary producers are affected by linear mortality (mL_XXX), extra mortality due to waves or fouling (mS_XXX) and optional acidification mortality. Mortality products are transferred to the SED labile and refractory detritus pools; the split between labile and refractory detritus is determined by the FDL_benthos parameter.</p>
</div>
</div>
<p><strong>Primary producer</strong> mortality in the <strong>water column and sediments</strong> is modelled as</p>
<p><span class="math display">\[M_{PP} = \ \left( \left( \frac{KLYS \cdot B_{PP}}{\delta_{nutrient} + 0.1} \right) + \left( mL \cdot B_{PP} + mA \cdot B_{PP} \right) \right) \cdot mortsc\]</span></p>
<p><strong>Primary producer</strong> mortality in the <strong>epibenthic layer</strong> is modelled as</p>
<p><span class="math display">\[M_{PP,EPI} = \ \left( mL \cdot B_{PP} + mA \cdot B_{PP} + mS \cdot B_{PP} \right) \cdot mortsc + F_{PP}\]</span></p>
<p>where <em>mL</em> (mL_XXX, day<sup>-1</sup>) is the linear mortality rate, <em>KLYS</em> is the lysis rate (KLYS_XXX, day<sup>-1</sup>), <em>mA</em> is the optional acidification mortality, <em>mS</em> is the extra mortality of large epibenthic primary producers calculated below, <em>B<sub>PP</sub></em> is the biomass of the primary producer, <em>mortsc</em> is the external mortality scalar (from forcing files) and <em>F<sub>PP</sub></em> is an optional fishing mortality that is sometimes applied to macroalgae.</p>
<p>The <strong>extra mortality <em>mS</em></strong> in <strong>large</strong> <strong>primary producers</strong> includes mortality due to waves and fouling:</p>
<p><span class="math display">\[mS_{MA} = \ STRESS \cdot \ mS\_\_ MA\]</span></p>
<p><span class="math display">\[mS_{SG} = \ DIN \cdot \ mS\_\_ SG\]</span></p>
<p>where <em>mS_MA</em> is the algal mortality rate (day<sup>-1</sup>) due to abrasion by bottom stress or waves (<em>STRESS</em>), provided through external forcing or calculated in the model (see Chapter 5, Physics) and <em>mS_SG</em> is the seagrass mortality rate (day<sup>-1</sup>) due to fouling by epiphytes in water of high nutrient concentration, and <em>DIN</em> is the concentration of NH3 and NO3.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>What is the difference between lysis and linear mortality?</strong><br>
Lysis represents cell leakage and is inversely related to nutrient concentration, whereas linear mortality is just a constant mortality term. PPBIM only had the linear mortality, but ERSEM also included lysis, and both options are included in Atlantis. The users have an option to use either or both, depending on the mortality parameter values set.</p>
</div>
</div>
<p>Finally, the extra mortality will also include any <strong>optional acidification induced mortality</strong>, described in details <a href="https://confluence.csiro.au/pages/viewpage.action?spaceKey=Atlantis&amp;postingDay=2012%2F10%2F19&amp;title=Handling+effects+of+acidification">here</a> and <a href="https://confluence.csiro.au/pages/viewpage.action?spaceKey=Atlantis&amp;postingDay=2015%2F5%2F14&amp;title=Acidification+induced+mortality">here</a> and in Chapter 13. The acidification mortality is only included if the model explicitly includes pH effects (flagmodelpH=1) and primary producers are identified as pH sensitive (flagpHsensitive_XXX=1).</p>
<p>Primary producer mortality is handled by <em>Primary_Production()</em> in <strong>atprocess.c</strong> and <em>Phytoplankton_ Process()</em> in <strong>atGroupProcess.c</strong> routines.</p>
</section>
<section id="encystment-of-primary-producers" class="level2">
<h2 class="anchored" data-anchor-id="encystment-of-primary-producers"><strong>9.4. Encystment of primary producers</strong></h2>
<p>It is possible to include the encystment of primary producers, triggered by time of the year or temperature. This option is only modelled for groups that have isOverWinter set to 1 in the <em>functional_groups.csv</em> file and is described in further detail on the wiki <a href="https://confluence.csiro.au/pages/viewpage.action?pageId=43155510">here</a>.</p>
</section>
<section id="effect-of-temperature-and-salinity-on-primary-production" class="level2">
<h2 class="anchored" data-anchor-id="effect-of-temperature-and-salinity-on-primary-production"><strong>9.5. Effect of temperature and salinity on primary production</strong></h2>
<p>Both light saturation (KI_XXX_T15) and maximum growth rate (mum_XXX_T15) are dependent on <strong>temperature</strong> and will be scaled by <em>Tcorr</em> calculated based on the current water temperature as described in chapter 13.</p>
<p>The <strong>salinity</strong> effect on light saturation and maximum growth rate are optional, where the <em>Scorr</em> is applied only when:</p>
<p>1) an organism is identified as sensitive to salinity, with flagSaltSensitive_XXX</p>
<p>2) an organism an outside the salinity limits defined with XXX_min_move_salt and XXX_max_ move_salt</p>
<p>If the two conditions are fulfilled, the <em>Scorr</em> scalar provided by the user as salt_correction_XXX parameter, is applied to KI_XXX_T15 and mum_XXX_T15 (along with the <em>Tcorr</em> described above).</p>
</section>
<section id="growth-of-mixotrophic-primary-producers" class="level2">
<h2 class="anchored" data-anchor-id="growth-of-mixotrophic-primary-producers"><strong>9.6. Growth of mixotrophic primary producers</strong></h2>
<p>Atlantis includes a mixotrophic dinaflagelate group DINOFLAG, the growth of which is determined by both primary production and heterotrophic consumption.</p>
<p>Phtosynthetic growth of DINOFLAG is as for other primary producers, although there is some increase in efficiency at low light levels, represented here by increasing effective light available via the following equation (which is only used if light levels drop below 10% of KI_XXX):</p>
<p><span class="math inline">\({IRR}_{sp} = KI_{XXX} \cdot \ (0.01 \cdot IRR + 0.018)\)</span></p>
<p>Mixotrophic growth due to consumption is calculated by first determining potential grazing (using the standard feeding routine applied to consumers). Phagotrophic growth then tops-up photosynthetic growth to the maximum possible rate, as if nutrients were non-limiting, unless the maximum growth rate is higher than what could be physically grazed. In this way grazing leads to additional growth compared to photosynthesis alone. Unlike in other consumers mixotrophic groups have no excretion (production of NH) as the nutrients are used in the photosynthetic growth pathway.</p>
<p>Nutrient stress related lysis of DINOFLAG is also corrected to account for the mitigating effects of phagotrophy), with the corection dictated by the proportion of photosynthetic nutrient made up by the grazing.</p>
<div class="table-responsive">
<div id="tbl-primary-production-parameters" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-primary-production-parameters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Primary production parameters for Atlantis model configuration
</figcaption>
<div aria-describedby="tbl-primary-production-parameters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Parameter</strong></th>
<th style="text-align: left;"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Key parameters defining primary production and primary producer mortality</strong></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">KN_XXX</td>
<td style="text-align: left;">Half-saturation constant for XXX growth on DIN (mgN m<sup>-3</sup>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">KS_XXX</td>
<td style="text-align: left;">Half-saturation constant for XXX growth on Si (mgN m<sup>-3</sup> ) – only important for Si limited groups, as defined in the <em>functional_groups.csv</em> file</td>
</tr>
<tr class="even">
<td style="text-align: left;">KI_XXX_T15</td>
<td style="text-align: left;">Light saturation of XXX at 15C (W m<sup>-2</sup>) - this parameter is temperature dependent (and potentially salinity dependent), and a scalar is applied based on current temperature (and salinity) conditions.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mum_XXX_T15</td>
<td style="text-align: left;">Maximum primary producer XXX growth rate at 15C (mgN mgN<sup>-1</sup> day<sup>-1</sup>) – this parameter is temperature dependent (and potentially salinity dependent), and a scalar is applied based on current temperature (and salinity) conditions.</td>
</tr>
<tr class="even">
<td style="text-align: left;">XXmax</td>
<td style="text-align: left;">Maximum biomass of large epibenthic primary producers (phytobenthos and macroalgae) (mgN m<sup>-2</sup>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mL_XXX</td>
<td style="text-align: left;">Linear mortality of primary producers (day<sup>-1</sup>)</td>
</tr>
<tr class="even">
<td style="text-align: left;">KLYS_XXX</td>
<td style="text-align: left;">Lysis rate of primary producers (day<sup>-1</sup>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mS_XXX</td>
<td style="text-align: left;">Extra mortality of macroalgae (PHYTOBEN) due to wave action (day<sup>-1</sup>)</td>
</tr>
<tr class="even">
<td style="text-align: left;">mS_XXX</td>
<td style="text-align: left;">Extra mortality of seagrasses (SEAGRASS) due to fouling (day<sup>-1</sup>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Further modification of primary production</strong></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">flaglight</td>
<td style="text-align: left;">Flag indication whether light adaptation in primary producers is activated (0=no, 1=yes), It set to 1 (i.e.&nbsp;activated) it will increase production at low light levels, but it will also require four additional parameters: KIOP_min, KIOP_shift, KI_avail, K_addepth (see SETas model example of <em>biology.prm</em> file)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flag_macro_model</td>
<td style="text-align: left;">Flag indicated whetehr a more detailed seagrass model is activated, see details <a href="https://confluence.csiro.au/display/Atlantis/2012/12/12/new+seagrass+modelling+option">here</a> (0=no, 1=yes). If the flag is set to 1 then three separate pools will be initiated and tracked for each SEAGRASS group type: main biomass, epiphyte biomass and below ground biomass</td>
</tr>
<tr class="even">
<td style="text-align: left;">flagnut</td>
<td style="text-align: left;">Nutrient limitation form used if primary production is limited by several nutrients (0=Leibig’s law where limitation is set by the most limiting nutrient; 1= multiplicative; 2=WQI)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flagmicronut</td>
<td style="text-align: left;">Flag indications whetehr there is miconutrient limitation (0=no, 1=yes)<br><br>If set to 1, half-saturation constant for gthe micronutrient (typically Fe) is required (KF_XXX)</td>
</tr>
<tr class="even">
<td style="text-align: left;">eddy_scale</td>
<td style="text-align: left;">Coefficient scaling eddy strength impact on phytoplankton growth</td>
</tr>
<tr class="odd">
<td style="text-align: left;">swr_scalar</td>
<td style="text-align: left;">Proportion of shortwave radiation available to photosynthesis – usually set to 0.45</td>
</tr>
<tr class="even">
<td style="text-align: left;">swr_const</td>
<td style="text-align: left;">Constant in the equation for the shortwave radiation available to photosynthesis – usually set to 1367.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">swr_cos_coefft</td>
<td style="text-align: left;">Coefficient of the cos term in the equation for the shortwave radiation available to photosynthesis – usually set to 0.034</td>
</tr>
<tr class="even">
<td style="text-align: left;">swr_cos_offset</td>
<td style="text-align: left;">Offset term in the cos term in the equation for the shortwave radiation available to photosynthesis – usually set to 0.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MB_wc</td>
<td style="text-align: left;">Scalar for microphytobenthos growth in the water column – growth should be strongly reduced as it is not on the substrate (which is its primary habitat). Only important when microphytobenthos is being modelled.</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>If TrackAtomicRatio is set to 1</strong> in <em>run.prm</em> file and the model tracks N:P:C many additional parameters are required to describe P, and C effect on primary production. See details <a href="https://confluence.csiro.au/display/Atlantis/2013/04/23/New+Phosphorus+tracking">here</a> and sample SETas model <em>biology.prm</em> file</p>
</div>
</div>
<p>: <span id="_Toc526762765" class="anchor"></span>Table 13. Parameters used for primary producer processes</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>