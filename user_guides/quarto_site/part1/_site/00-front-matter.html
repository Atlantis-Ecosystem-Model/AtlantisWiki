<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.43">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Atlantis User Guide – Front Matter</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Atlantis User Guide</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Front Matter</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Atlantis User Guide</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-foreward.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">0. FOREWARD</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. INTRODUCTION</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-installation-and-running.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. INSTALLATION AND RUNNING</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-geometry-of-the-model-domain.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. GEOMETRY OF THE MODEL DOMAIN</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-hydrodynamic-salinity-and-temperature-forcing-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. HYDRODYNAMIC, SALINITY AND TEMPERATURE FORCING DATA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-the-physics-submodel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. THE PHYSICS SUBMODEL</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-definitions-of-functional-groups.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. DEFINITIONS OF FUNCTIONAL GROUPS</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-run-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">7. RUN PARAMETERS</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-force-parameters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. FORCE PARAMETERS</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-primary-producer-processes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. PRIMARY PRODUCER PROCESSES</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-consumer-processes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">10. CONSUMER PROCESSES</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-distribution-and-movement.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11. DISTRIBUTION AND MOVEMENT</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-processes-in-bacterial-and-inanimate-pools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">12. PROCESSES IN BACTERIAL AND INANIMATE POOLS</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./14-influence-of-environmental-factors-on-ecological-p.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">13. INFLUENCE OF ENVIRONMENTAL FACTORS ON ECOLOGICAL PROCESSES</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./15-final-overview-of-ecology-routines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">14. FINAL OVERVIEW OF ECOLOGY ROUTINES</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./16-references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">REFERENCES</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./17-appendix-1-tips-for-calibrating-biological-model-n.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix 1: TIPS FOR CALIBRATING BIOLOGICAL MODEL: NOTES FROM THE 2015 ATLANTIS SUMMIT</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
        
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Front Matter</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Atlantis User’s Guide</strong></p>
<p><strong>Part I:</strong></p>
<p><strong>General Overview, Physics &amp; Ecology</strong></p>
<p><strong>___________________________________</strong></p>
<p>Asta Audzijonyte, Rebecca Gorton, Isaac Kaplan,</p>
<p>Jacob M. Kasper, Elizabeth A. Fulton</p>
<p>Original Date: April 2017</p>
<p>Current Update: May 2025</p>
<p><img src="media/image1.jpg" style="width:1.86944in;height:1.86944in"></p>
<p>****</p>
<p>TABLE OF CONTENTS</p>
<p><a href="#foreward">FOREWARD [10](#foreward)</a></p>
<p><a href="#introduction">1. INTRODUCTION [11](#introduction)</a></p>
<p><a href="#goals-of-this-manual-and-where-to-go-from-here"><strong>1.1. Goals of this manual and where to go from here</strong> [11](#goals-of-this-manual-and-where-to-go-from-here)</a></p>
<p><a href="#terms-and-conventions-used-in-the-manual"><strong>1.2. Terms and conventions used in the manual</strong> [12](#terms-and-conventions-used-in-the-manual)</a></p>
<p><a href="#what-is-atlantis"><strong>1.3. What is Atlantis?</strong> [13](#what-is-atlantis)</a></p>
<p><a href="#existing-applications-and-questions-studied"><strong>1.4. Existing applications and questions studied</strong> [15](#existing-applications-and-questions-studied)</a></p>
<p><a href="#how-does-atlantis-compare-to-other-marine-ecosystem-models"><strong>1.5. How does Atlantis compare to other marine ecosystem models?</strong> [19](#how-does-atlantis-compare-to-other-marine-ecosystem-models)</a></p>
<p><a href="#main-assumptions"><strong>1.6. Main assumptions</strong> [21](#main-assumptions)</a></p>
<p><a href="#installation-and-running">2. INSTALLATION AND RUNNING [22](#installation-and-running)</a></p>
<p><a href="#how-to-check-out-and-install-the-code"><strong>2.1 How to check out and install the code</strong> [22](#how-to-check-out-and-install-the-code)</a></p>
<p><a href="#input-files"><strong>2.2. Input files</strong> [27](#input-files)</a></p>
<p><a href="#overview-of-atlantis-submodels-and-the-main-routine"><strong>2.3. Overview of Atlantis submodels and the main() routine</strong> [28](#overview-of-atlantis-submodels-and-the-main-routine)</a></p>
<p><a href="#delving-into-the-code-finding-the-files-and-routines-that-describe-the-processes-you-are-interested-in"><strong>2.4. Delving into the code: finding the files and routines that describe the processes you are interested in</strong> [30](#delving-into-the-code-finding-the-files-and-routines-that-describe-the-processes-you-are-interested-in)</a></p>
<p><a href="#how-to-setup-and-start-simulations"><strong>2.5. How to setup and start simulations</strong> [33](#how-to-setup-and-start-simulations)</a></p>
<p><a href="#crash-introduction-into-command-line-interfaces"><em>2.5.1. Crash introduction into Command line interfaces</em> [33](#crash-introduction-into-command-line-interfaces)</a></p>
<p><a href="#setting-up-the-bat-file"><em>2.5.2. Setting up the BAT file</em> [34](#setting-up-the-bat-file)</a></p>
<p><a href="#parameter-files-called-in-the-bat-command-line"><em>2.5.3. Parameter files called in the BAT command line</em> [35](#parameter-files-called-in-the-bat-command-line)</a></p>
<p><a href="#setting-up-batch-simulations"><em>2.5.4. Setting up batch simulations</em> [36](#setting-up-batch-simulations)</a></p>
<p><a href="#initialising-simulations"><em>2.5.5. Initialising simulations</em> [37](#initialising-simulations)</a></p>
<p><a href="#_Toc123075512"><strong>2.6. Simulation outputs</strong> [39](#_Toc123075512)</a></p>
<p><a href="#_Toc123075513"><strong>2.7. Introduction to NetCDF files</strong> [44](#_Toc123075513)</a></p>
<p><a href="#_Toc123075514"><strong>2.8. Introduction to Atlantis variables</strong> [47](#_Toc123075514)</a></p>
<p><a href="#chapter29"><strong>2.9 Tools and packages to view and analyse Atlantis input and output files</strong> [50](#chapter29)</a></p>
<p><a href="#troubleshooting-on-installation-and-running"><strong>2.10. Troubleshooting on installation and running</strong> [51](#troubleshooting-on-installation-and-running)</a></p>
<p><a href="#_Toc123075517">3. GEOMETRY OF THE MODEL DOMAIN [55](#_Toc123075517)</a></p>
<p><a href="#_Toc123075518"><strong>3.1. Boxes and layers defining the geometry of the model</strong> [55](#_Toc123075518)</a></p>
<p><a href="#_Toc123075519"><strong>3.2. How to define a geometry file for a new model?</strong> [57](#_Toc123075519)</a></p>
<p><a href="#practical-steps-for-building-the-bgm-files-from-gis-shapefiles"><strong>3.3. Practical steps for building the BGM files from GIS shapefiles</strong> [62](#practical-steps-for-building-the-bgm-files-from-gis-shapefiles)</a></p>
<p><a href="#_Toc123075521"><strong>3.4. How to view your model geometry?</strong> [63](#_Toc123075521)</a></p>
<p><a href="#_Toc123075522"><strong>3.5 Using R for BGM geometry</strong> [63](#_Toc123075522)</a></p>
<p><a href="#_Toc123075523">4. HYDRODYNAMIC, SALINITY AND TEMPERATURE FORCING DATA [64](#_Toc123075523)</a></p>
<p><a href="#_Toc123075524"><strong>4.1. General introduction to forcing of Atlantis models</strong> [64](#_Toc123075524)</a></p>
<p><a href="#_Toc123075525"><strong>4.2. Transforming oceanographic model output into Atlantis forcing files</strong> [66](#_Toc123075525)</a></p>
<p><a href="#_Toc123075526"><strong>4.3. Things to keep in mind about hydrodynamic forcing files</strong> [67](#_Toc123075526)</a></p>
<p><a href="#_Toc123075527"><strong>4.4. Numbering of vertical layers in the input and output NC files</strong> [69](#_Toc123075527)</a></p>
<p><a href="#_Toc123075528"><strong>4.5. Viewing and checking forcing input files with R</strong> [70](#_Toc123075528)</a></p>
<p><a href="#_Toc123075529"><strong>4.6. Light and noise pollution</strong> [71](#_Toc123075529)</a></p>
<p><a href="#_Toc123075530">5. THE PHYSICS SUBMODEL [71](#_Toc123075530)</a></p>
<p><a href="#physical-and-biogeochemical-variables-and-their-characteristics"><strong>5.1. Physical and biogeochemical variables and their characteristics</strong> [72](#physical-and-biogeochemical-variables-and-their-characteristics)</a></p>
<p><a href="#_Toc123075532"><strong>5.2. The main <em>physics()</em> routine</strong> [74](#_Toc123075532)</a></p>
<p><a href="#_Toc123075533"><strong>5.3. Other parameters in <em>physics.prm</em> not included in the <em>physics()</em> routine</strong> [87](#_Toc123075533)</a></p>
<p><a href="#_Toc123075534"><strong>5.4. When to use vertical and horizontal transport and mixing?</strong> [89](#_Toc123075534)</a></p>
<p><a href="#_Toc123075535"><strong>5.5. Latest developments</strong> [91](#_Toc123075535)</a></p>
<p><a href="#_Toc123075536"><em>5.5.1 Land</em> [91](#_Toc123075536)</a></p>
<p><a href="#_Toc123075537"><em>5.5.2. Ice</em> [91](#_Toc123075537)</a></p>
<p><a href="#_Toc123075538"><em>5.5.3. Contaminants</em> [91](#_Toc123075538)</a></p>
<p><a href="#_Toc123075539"><strong>5.6. Outputs of physics tracers in the <em>output.nc</em> file</strong> [95](#_Toc123075539)</a></p>
<p><a href="#_Toc123075540"><strong>5.7. Importance of optional physics routines</strong> [98](#_Toc123075540)</a></p>
<p><a href="#_Toc123075541"><strong>5.8. Checking hydrodynamic transports</strong> [100](#_Toc123075541)</a></p>
<p><a href="#definitions-of-functional-groups">6. DEFINITIONS OF FUNCTIONAL GROUPS [101](#definitions-of-functional-groups)</a></p>
<p><a href="#introduction-to-functional-groups"><strong>6.1. Introduction to functional groups</strong> [101](#introduction-to-functional-groups)</a></p>
<p><a href="#defining-functional-groups"><strong>6.2. Defining functional groups</strong> [105](#defining-functional-groups)</a></p>
<p><a href="#_Toc123075545"><strong>6.3. Defining the GroupType correctly</strong> [111](#_Toc123075545)</a></p>
<p><a href="#_Toc123075546"><strong>6.4. Modifying functional groups in parameterised models</strong> [112](#_Toc123075546)</a></p>
<p><a href="#run-parameters">7. RUN PARAMETERS [112](#run-parameters)</a></p>
<p><a href="#force-parameters">8. FORCE PARAMETERS [119](#force-parameters)</a></p>
<p><a href="#_Toc123075549">9. PRIMARY PRODUCER PROCESSES [130](#_Toc123075549)</a></p>
<p><a href="#_Toc123075550"><strong>9.1. Fluxes in primary producers</strong> [130](#_Toc123075550)</a></p>
<p><a href="#_Toc123075551"><strong>9.2. Primary producer growth</strong> [132](#_Toc123075551)</a></p>
<p><a href="#_Toc123075552"><em>9.2.1. Primary producer nutrient limitation</em> [132](#_Toc123075552)</a></p>
<p><a href="#_Toc123075553"><em>9.2.2. Primary producer light limitation</em> [133](#_Toc123075553)</a></p>
<p><a href="#_Toc123075554"><em>9.2.3. Primary macrophyte producer space limitation</em> [134](#_Toc123075554)</a></p>
<p><a href="#_Toc123075555"><em>9.2.4 Effect of eddies on primary production</em> [135](#_Toc123075555)</a></p>
<p><a href="#_Toc123075556"><strong>9.3. Primary producer mortality</strong> [136](#_Toc123075556)</a></p>
<p><a href="#_Toc123075557"><strong>9.4. Encystment of primary producers</strong> [137](#_Toc123075557)</a></p>
<p><a href="#_Toc123075558"><strong>9.5. Effect of temperature and salinity on primary production</strong> [137](#_Toc123075558)</a></p>
<p><a href="#growth-of-mixotrophic-primary-producers"><strong>9.6. Growth of mixotrophic primary producers</strong> [138](#growth-of-mixotrophic-primary-producers)</a></p>
<p><a href="#consumer-processes">10. CONSUMER PROCESSES [139](#consumer-processes)</a></p>
<p><a href="#_Toc123075561"><strong>10.1. Fluxes in consumer biomass pools</strong> [140](#_Toc123075561)</a></p>
<p><a href="#consumer-feeding"><strong>10.2. Consumer feeding</strong> [141](#consumer-feeding)</a></p>
<p><a href="#grazing"><em>10.2.1 Grazing</em> [142](#grazing)</a></p>
<p><a href="#what-are-the-c-and-mum-parameters"><em>10.2.2 What are the</em> C <em>and</em> mum <em>parameters?</em> [144](#what-are-the-c-and-mum-parameters)</a></p>
<p><a href="#_Toc123075565"><em>10.2.3. What determines prey biomass available for predation?</em> [148](#_Toc123075565)</a></p>
<p><a href="#_Toc123075566"><em>10.2.5. Size refuge from predation</em> [153](#_Toc123075566)</a></p>
<p><a href="#_Toc123075567"><em>10.2.6. Availability of fisheries catches to opportunistic catch-eaters</em> [157](#_Toc123075567)</a></p>
<p><a href="#effect-of-temperature-and-salinity-on-feeding-parameters"><em>10.2.7. Effect of temperature and salinity on feeding parameters</em> [157](#effect-of-temperature-and-salinity-on-feeding-parameters)</a></p>
<p><a href="#effect-of-oxygen-limitation-on-epibenthic-invertebrate-feeding-rates"><em>10.2.8. Effect of oxygen limitation on epibenthic invertebrate feeding rates</em> [157](#effect-of-oxygen-limitation-on-epibenthic-invertebrate-feeding-rates)</a></p>
<p><a href="#effect-of-space-limitation-on-epibenthic-invertebrate-feeding-rates"><em>10.2.9. Effect of space limitation on epibenthic invertebrate feeding rates</em> [159](#effect-of-space-limitation-on-epibenthic-invertebrate-feeding-rates)</a></p>
<p><a href="#other-factors-affecting-feeding-parameters"><em>10.2.10. Other factors affecting feeding parameters</em> [159](#other-factors-affecting-feeding-parameters)</a></p>
<p><a href="#other-feeding-functional-responses"><em>10.2.11 Other feeding functional responses</em> [160](#other-feeding-functional-responses)</a></p>
<p><a href="#food-assimilation-in-consumers"><strong>10.3. Food assimilation in consumers</strong> [164](#food-assimilation-in-consumers)</a></p>
<p><a href="#maintenance-respiration-in-consumers"><strong>10.4. Maintenance (respiration) in consumers</strong> [165](#maintenance-respiration-in-consumers)</a></p>
<p><a href="#_Toc123075575"><em>10.4.1 Scaling of respiration costs depending on individual’s condition</em> [166](#_Toc123075575)</a></p>
<p><a href="#growth"><strong>10.5. Growth</strong> [167](#growth)</a></p>
<p><a href="#_Toc123075577"><em>10.5.1. Growth and energy allocation in age-structured groups</em> [167](#_Toc123075577)</a></p>
<p><a href="#when-is-an-age-structured-group-starving-and-what-does-it-mean"><em>10.5.2. When is an age-structured group starving and what does it mean?</em> [169](#when-is-an-age-structured-group-starving-and-what-does-it-mean)</a></p>
<p><a href="#_Toc123075579"><em>10.5.3 Growth in consumer biomass pools</em> [169](#_Toc123075579)</a></p>
<p><a href="#_Toc123075580"><em>10.5.4 Feeding on material outside the model</em> [172](#_Toc123075580)</a></p>
<p><a href="#_Toc123075581"><em>10.5.4 Effect of contaminants on the growth model</em> [174](#_Toc123075581)</a></p>
<p><a href="#mortality-in-consumers"><strong>10.6. Mortality in consumers</strong> [176](#mortality-in-consumers)</a></p>
<p><a href="#_Toc123075583"><em>10.6.1. Mortality in age-structured groups</em> [176](#_Toc123075583)</a></p>
<p><a href="#_Toc123075584"><em>10.6.2. Starvation mortality in age-structured groups</em> [177](#_Toc123075584)</a></p>
<p><a href="#_Toc123075585"><em>10.6.3. Extra mortality in age-structured groups</em> [178](#_Toc123075585)</a></p>
<p><a href="#_Toc123075586"><em>10.6.4. Mortality in biomass pool consumers</em> [179](#_Toc123075586)</a></p>
<p><a href="#_Toc123075587"><em>10.6.5. Temperature and acidification effect on mortality</em> [179](#_Toc123075587)</a></p>
<p><a href="#_Toc123075588"><em>10.6.6. Turbidity effect on mortality</em> [179](#_Toc123075588)</a></p>
<p><a href="#waste-production"><strong>10.7. Waste production</strong> [180](#waste-production)</a></p>
<p><a href="#spawn"><strong>10.8. Spawn</strong> [184](#spawn)</a></p>
<p><a href="#sexual-maturation-in-age-structured-groups"><em>10.8.1. Sexual maturation in age-structured groups</em> [184](#sexual-maturation-in-age-structured-groups)</a></p>
<p><a href="#recruitment-and-ageing"><strong>10.9. Recruitment and ageing</strong> [186](#recruitment-and-ageing)</a></p>
<p><a href="#_Toc123075593"><em>10.9.1 Routines used to calculate recruitment in age-structured groups</em> [187](#_Toc123075593)</a></p>
<p><a href="#_Toc123075594"><em>10.9.2. Stock-recruitment options</em> [187](#_Toc123075594)</a></p>
<p><a href="#_Toc123075595"><em>10.9.3. Environmental, habitat and external recruitment scalars</em> [193](#_Toc123075595)</a></p>
<p><a href="#_Toc123075596"><em>10.9.4. Spatial distribution of recruits</em> [195](#_Toc123075596)</a></p>
<p><a href="#_Toc123075597"><em>10.9.5. Factors defining temporal arrival of recruits</em> [196](#_Toc123075597)</a></p>
<p><a href="#_Toc123075598"><em>10.9.6. Modifying size at recruitment</em> [196](#_Toc123075598)</a></p>
<p><a href="#_Toc123075599"><em>10.9.7. Stochastic variation around mean recruitment</em> [197](#_Toc123075599)</a></p>
<p><a href="#_Toc123075600"><em>10.9.8. Ageing of individuals</em> [198](#_Toc123075600)</a></p>
<p><a href="#_Toc123075601">11. DISTRIBUTION AND MOVEMENT [199](#_Toc123075601)</a></p>
<p><a href="#_Toc123075602">11.1 Spatial distribution without migration or density dependent movement [200](#_Toc123075602)</a></p>
<p><a href="#_Toc123075603">11.2 Spatial distribution with density dependent movement [201](#_Toc123075603)</a></p>
<p><a href="#_Toc123075604">11.3. Forcing the model distributions with species distribution models [204](#_Toc123075604)</a></p>
<p><a href="#_Toc123075605">11.4. Migration into and out of the model domain [206](#_Toc123075605)</a></p>
<p><a href="#_Toc123075606">11.5. External population model [209](#_Toc123075606)</a></p>
<p><a href="#_Toc123075607">11.5. Invading species [209](#_Toc123075607)</a></p>
<p><a href="#_Toc123075608">12. PROCESSES IN BACTERIAL AND INANIMATE POOLS [210](#_Toc123075608)</a></p>
<p><a href="#bacterial-processes"><strong>12.1. Bacterial processes</strong> [210](#bacterial-processes)</a></p>
<p><a href="#biogeochemical-processes"><strong>12.2 Biogeochemical processes</strong> [213](#biogeochemical-processes)</a></p>
<p><a href="#influence-of-environmental-factors-on-ecological-processes">13. INFLUENCE OF ENVIRONMENTAL FACTORS ON ECOLOGICAL PROCESSES [213](#influence-of-environmental-factors-on-ecological-processes)</a></p>
<p><a href="#temperature-two-methods-to-get-temperature-scalar"><strong>13.1. Temperature: two methods to get temperature scalar</strong> [213](#temperature-two-methods-to-get-temperature-scalar)</a></p>
<p><a href="#temperature-effects-on-feeding-parameters-and-assimilation-efficiency"><strong>13.2. Temperature: effects on feeding parameters and assimilation efficiency</strong> [215](#temperature-effects-on-feeding-parameters-and-assimilation-efficiency)</a></p>
<p><a href="#salinity"><strong>13.3. Salinity</strong> [216](#salinity)</a></p>
<p><a href="#acidification"><strong>13.4. Acidification</strong> [217](#acidification)</a></p>
<p><a href="#oxygen"><strong>13.5. Oxygen</strong> [218](#oxygen)</a></p>
<p><a href="#final-overview-of-ecology-routines">14. FINAL OVERVIEW OF ECOLOGY ROUTINES [218](#final-overview-of-ecology-routines)</a></p>
<p><a href="#references">REFERENCES [223](#references)</a></p>
<p><a href="#appendix-1-tips-for-calibrating-biological-model-notes-from-the-2015-atlantis-summit">Appendix 1: TIPS FOR CALIBRATING BIOLOGICAL MODEL: NOTES FROM THE 2015 ATLANTIS SUMMIT [228](#appendix-1-tips-for-calibrating-biological-model-notes-from-the-2015-atlantis-summit)</a></p>
<p><a href="#tips-for-parameterizing-biomass-pools-invertebrates"><strong>Tips for parameterizing biomass pools (invertebrates)</strong> [230](#tips-for-parameterizing-biomass-pools-invertebrates)</a></p>
<p><a href="#tips-for-parameterizing-age-structured-vertebrate-groups"><strong>Tips for parameterizing age-structured (vertebrate) groups</strong> [230](#tips-for-parameterizing-age-structured-vertebrate-groups)</a></p>
<p><a href="#starvation-and-respiration">Starvation and respiration [230](#starvation-and-respiration)</a></p>
<p><a href="#movement">Movement [230](#movement)</a></p>
<p><a href="#reproduction">Reproduction [231](#reproduction)</a></p>
<p><a href="#growth-consumption-and-predator-prey-functional-response">Growth, consumption, and predator-prey functional response [231](#growth-consumption-and-predator-prey-functional-response)</a></p>
<p><a href="#other-mortality">Other mortality [232](#other-mortality)</a></p>
<p><a href="#tips-on-parameterizing-biogeochemistry"><strong>Tips on parameterizing biogeochemistry</strong> [232](#tips-on-parameterizing-biogeochemistry)</a></p>
<p><a href="#tips-on-handling-ocean-acidification"><strong>Tips on handling ocean acidification</strong> [232](#tips-on-handling-ocean-acidification)</a></p>
<p>****</p>
<p><strong>Tables</strong></p>
<p><a href="#_Toc526762753">Table 1. Examples of Atlantis model applications and their main purposes: P = primary use of the model, S = secondary use, E = exploratory use beginning (modified after Fulton et al.&nbsp;2011). Some of the model descriptions are included in the useful reading page on the wiki. An updated list of models under development is also available on Atlantis webpage [17](#_Toc526762753)</a></p>
<p><a href="#_Toc526762754">Table 2. Some example findings from Atlantis applications (modified after Fulton et al.&nbsp;2011) [18](#_Toc526762754)</a></p>
<p><a href="#_Toc445899521">Table 3. Main Atlantis output files. The main output files of interest for beginner users are shown in grey boxes. The table first lists Biology related outputs and then Harvest submodel related outputs. Please note, that the list of output files are continuously updated, so check the wiki for any changes. [41](#_Toc445899521)</a></p>
<p><a href="#_Toc526762756">Table 4. Parameters used to describe characteristics of Atlantis variables in the initial_conditions.nc file. These parameters are read in by the readBMTracerInfo() in attracerIO.c [48](#_Toc526762756)</a></p>
<p><a href="#_Toc526762757">Table 5. Hydrodynamic structure of some example Atlantis models. Advect = advection, temp = temperature, salt = salinity. [65](#_Toc526762757)</a></p>
<p><a href="#_Toc526762758">Table 6. Examples of currently used obligatory and optional physics and biogeochemical tracers and variables and their characteristics as defined in the initial_conditions.nc file (collected from different Atlantis applications and used for illustration purposes only). Further description of tracers and physics variables is given in the following chapters on sediment and biological processes. [73](#_Toc526762758)</a></p>
<p><a href="#_Toc526762759">Table 7. List and characteristics of physics variables given in the output.nc files (the same variables are given in the initial_conditions.nc file but without the time dimension). [96](#_Toc526762759)</a></p>
<p><a href="#_Toc526762760">Table 8. State variables tracked in the main Atlantis model (no ice or land included). * indicates optional Si tracking in primary producers that are limited by Si. Primary producer Si limitation is set in functional_groups.csv file parameter IsSiliconDep (see Table 6.2). In models that include C and P, both C and P are tracked like N (so the number of variable tracked is three times larger). [103](#_Toc526762760)</a></p>
<p><a href="#_Toc526762761">Table 9. Parameters in the functional_groups.csv file. [105](#_Toc526762761)</a></p>
<p><a href="#_Toc526762762">Table 10. Routines called for different non-vertebrate GroupTypes in Atlantis code. The Call_Group_Process_Function() routine in atecology.c determines the specific routine used from the atGroupProcess.c file non vertebrate groups. Note, that the greatest diversity ofroutines are called for different benthic invertebrate types (for clarity benthic invertebrates are shown in bold italics). [111](#_Toc526762762)</a></p>
<p><a href="#_Toc526762763">Table 11. List and description of parameters in the run.prm file [113](#_Toc526762763)</a></p>
<p><a href="#_Toc526762764">Table 12. List and description of external forcing options available in Atlantis [122](#_Toc526762764)</a></p>
<p><a href="#_Toc526762765">Table 13. Parameters used for primary producer processes [138](#_Toc526762765)</a></p>
<p><a href="#_Toc526762766">Table 14. General feeding parameters and units [147](#_Toc526762766)</a></p>
<p><a href="#_Toc526762767">Table 15. Parameters defining habitat associations and habitat refuge. [152](#_Toc526762767)</a></p>
<p><a href="#_Toc526762768">Table 16. Parameters defining size refuge for age structured groups [157](#_Toc526762768)</a></p>
<p><a href="#_Toc526762769">Table 17. Parameters defining feeding on fisheries catches [157](#_Toc526762769)</a></p>
<p><a href="#_Toc526762770">Table 18. Equations defining grazing term in the twelve currently available feeding functional responses. Some of these responses are described and compared in Fulton et al.&nbsp;2003a “Mortality and predation in ecosystem models: is it important how these are expressed?” Ecological Modelling 169,157–178 [161](#_Toc526762770)</a></p>
<p><a href="#_Toc526762771">Table 19. Parameters defining respiration rates in age structured groups [167](#_Toc526762771)</a></p>
<p><a href="#_Toc526762772">Table 20. Parameters affecting growth in consumers [173](#_Toc526762772)</a></p>
<p><a href="#_Toc526762773">Table 21. Parameters needed for contaminant uptake model – where XXX is the functional group code and CCC the contaminant name. [175](#_Toc526762773)</a></p>
<p><a href="#_Toc526762774">Table 22. Parameters affecting mortality in consumers [180](#_Toc526762774)</a></p>
<p><a href="#_Toc526762775">Table 23. Parameters determining waste production processes [183](#_Toc526762775)</a></p>
<p><a href="#_Toc526762776">Table 23. Parameters determining maturation and spawn [186](#_Toc526762776)</a></p>
<p><a href="#_Toc526762777">Table 24. Parameters used in the invading species sub-model [210](#_Toc526762777)</a></p>
<p><a href="#_Toc526762778">Table 25. Effects of pH on physiological and ecological processes. See detailed description here [217](#_Toc526762778)</a></p>
<p><a href="#_Toc526762779">Table 26. List of key ecological processes run in the three main distribution types: water colum, sediment, and epibenthic layer. List of the pools tracked in the three types is given in table 8. [221](#_Toc526762779)</a></p>
<p><a href="#_Toc526762780">Table 27. Basic assumptions and formulations in the Atlantis model (modified after Fulton et al.&nbsp;2004b). [222](#_Toc526762780)</a></p>
<p><strong>Figures</strong></p>
<p><a href="#_Toc446445862">Figure 1. Some existing applications of Atlantis modelling framework and specific model domains (see Table 1 for details on numbered models). [16](#_Toc446445862)</a></p>
<p><a href="#_Ref445803305">Figure 2.Schematic representation of the Atlantis model structure and input files. Submodels coloured in green are obligatory. Files marked with * are required, others are optional. [29](#_Ref445803305)</a></p>
<p><a href="#_Toc526762783">Figure 3. Brief overview of the Atlantis main() routine that calls other routines implemented in various submodels. [30](#_Toc526762783)</a></p>
<p><a href="#_Toc526762784">Figure 4. Top: An example cross section of an Atlantis model, showing water column and sediment layers. Oceanic boxes have an open water boundary at the bottom of the deepest water layer. The depths of vertical layers do not have to be the same in all boxes, although most models keep them identical for simplicity (shown with horizontal dashed line). The depth of the bottom water column layer varies depending on the geography of the marine system. Bottom: An example of the horizontal Atlantis model domain (set in the BGM file) [56](#_Toc526762784)</a></p>
<p><a href="file:////Users/ful083/Work/atlantis/manual/final_uploaded_manual_version/AtlantisUserGuide_PartI.docx#_Toc526762785">Figure 5. Example of an Atlantis model geometry (part of a model domain). Boxes are numbered in bold, grey boxes indicate boundary or island (land) boxes. Faces are numbered in italic numbers. Vertices are shown as dots; vertices P1 and P2 describe face 5. [58](#_Toc446445864)</a></p>
<p><a href="file:////Users/ful083/Work/atlantis/manual/final_uploaded_manual_version/AtlantisUserGuide_PartI.docx#_Toc526762786">Figure 6. An example of oceanographic sigma depth layers (grey lines) with an overlay of Atlantis spatial structure. Figure by Javier Porobic Garate [66](#_Toc526762786)</a></p>
<p><a href="#_Toc526762787">Figure 7. Main steps in converting oceanographic files into Atlantis input files, as done using two CSIRO contributed scripts Hydro and Hydroconstruct. Figure by Javier Porobic Garate [67](#_Toc526762787)</a></p>
<p><a href="#_Toc526762788">Figure 8. Illustration of optional physics routines described in detail above. Some boxes have two sediment layers. Vertical mixing can also be set as downwelling, but only one direction is possible in a given simulation. [83](#_Toc526762788)</a></p>
<p><a href="#_Toc526762789">Figure 9. Total final biomass ratios of all Baltic Sea model functional groups in scenarios exploring the effects of optional physics routines. The simulations were run for 20 years. [99](#_Toc526762789)</a></p>
<p><a href="#_Toc526762790">Figure 10. The value of grazing term (Gr) as a function of prey biomass (ranging from 0 to 1x of the predator biomass) and different assumptions on the ratio between C and mum. Predators biomass is 1000mgN, C = 100 m<sup>3</sup> ind<sup>-1</sup> day<sup>-1</sup>. The calculations assume only one prey, no refuge (δ<sub>refuge</sub>=1), maximum availability p<sub>prey,CX</sub> of 1, and assimilation efficiencies E<sub>prey,i</sub> of 1. Black: mum = C, orange: mum = C*3, blue: mum =C/5 [145](#_Toc526762790)</a></p>
<p><a href="#_Toc526762791">Figure 11. Habitat refuge scalar on prey availability as a function of cell area covered with suitable habitats (see box above for details on calculations of suitable cover area). [151](#_Toc526762791)</a></p>
<p><a href="#_Toc526762792">Figure 12. Prey availability scalar Size_Scalar<sub>prey</sub> of different sized prey for different Kmax_coefft values for humped selectivity curve. [154](#_Toc526762792)</a></p>
<p><a href="#_Toc526762793">Figure 13. Prey availability scalar δ<sub>size</sub> of different sized prey for bilogistic selectivity curve. [155](#_Toc526762793)</a></p>
<p><a href="#_Toc526762794">Figure 14. Oxygen limitation scalar δ<sub>O2</sub> for different ambient oxygen concentrations, assuming KO2=50 mgO2 m<sup>-3</sup> and KO2lim = 100 mgO2 m<sup>-3</sup>. [158](#_Toc526762794)</a></p>
<p><a href="#_Toc526762795">Figure 15. Proportion of available energy allocated to SN, depending on the individual’s condition (RN/SN, on x axis), and pR and X_RS parameters. [168](#_Toc526762795)</a></p>
<p><a href="#_Toc526762796">Figure 16. Starvation mortality (per day) for different Kthreshm and mStarve values. [178](#_Toc526762796)</a></p>
<p><a href="#_Toc526762797">Figure 17. Nitrogen flow from consumers to detrital and ammonia pools. Parameters that determine allocation between the pools are shown on the arrows. Optional fluxes are shown in dashed arrows. [181](#_Toc526762797)</a></p>
<p><a href="#_Toc526762798">Figure 18. Tracking of calendar years in Atlantis age groups. Left: three calendar years for each of the four age groups (AG1-AG4) illustrated. Right: dampening of strong year classes through time. [198](#_Toc526762798)</a></p>
<p><a href="#_Toc526762799">Figure 19. The T<sub>scalar</sub> values at different water temperatures. [214](#_Toc526762799)</a></p>
<p><a href="#_Toc526762800">Figure 20. A humped temperature response used when q10_method_XXX=1. [215](#_Toc526762800)</a></p>
<p>****</p>
<p><strong>Acknowledgements</strong></p>
<p>The authors want to express their sincere thanks to everyone who helped to prepare this manual, especially Shane Richards, Ingrid van Putten, Heidi Pethybridge, Cathy Bulman, Javier Porobic Garate, Thibaut Houitte de La Chesnais, Michael Sumner and many others who read the earlier versions of this manual and provided valuable feedback. We would also like to acknowledge that earliest stages of the compilation of the manual was facilitated by the Atlantis Summit (Hawaii 2015), funded by the CSIRO, US National Oceanic and Atmospheric Administration, and the Norwegian Institute of Marine Resources. Lastly, this work would not have been possible without the funding support through the years of the model development of the CSIRO, Australian Fisheries Research and Development Corporation (FRDC), National Oceanic and Atmospheric Administration (NOAA), the Gordon and Betty Moore Foundation, and the David and Lucile Packard Foundation.</p>



</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>